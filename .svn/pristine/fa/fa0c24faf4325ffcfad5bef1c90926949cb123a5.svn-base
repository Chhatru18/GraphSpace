{% extends 'base.html' %}
{% block content %}

{% include 'graphs/help_menu.html' %}

<p>
GraphSpace provides a RESTful API for managing your graphs.
Graphs are represented in <a href="http://json.org">JSON</a> format.
</p>

<h3>Prerequisites</h3>

<p>
To execute the examples from the command line you will need an HTTP client. On Debian systems you can install by running

<pre>
sudo apt-get install libwww-perl
</pre>

Also, you will need a user account on graphspace.
</p>

Finally, you can save the following graph to a file as an example.

<pre>
{
   "metadata" : {
      "name" : "foo graph",
      "tags" : ["foo", "bar"]
   },
   "graph" : {
      "data" : {
         "edges" : [
            { "source" : "2", "target" : "1", "id" : "2-1" }
         ],
         "nodes" : [
            { "label" : "A", "id" : "1" },
            { "label" : "B", "id" : "2" }
         ]
      }
   }
}
</pre>

</p>

<h3>API calls</h3>

<p>
Below is a list of the different API calls.
</p>

<ul>
<li><h4><a href="#graphs">Graphs</a></h4>
<ul>
<li><a href="#add_graph">Add graph</a></li>
<li><a href="#get_graph">Get graph</a></li>
<li><a href="#remove_graph">Remove graph</a></li>
<li><a href="#get_user_graphs">Get user graphs</a></li>
</ul>
</li>
<li><h4><a href="#groups">Groups</a></h4>
<ul>
<li><a href="#get_groups">Get groups</a></li>
<li><a href="#get_group">Get group</a></li>
<li><a href="#remove_group">Remove group</a></li>
<li><a href="#create_group">Create group</a></li>
<li><a href="#get_user_groups">Get groups a user belongs to</a></li>
<li><a href="#add_user_to_group">Add user to group</a></li>
<li><a href="#remove_user_from_group">Remove user from group</a></li>
<li><a href="#share_graph">Share a graph with a group</a></li>
<li><a href="#unshare_graph">Unshare a graph with a group</a></li>
</ul>
</li>
</ul>

<h2 id="graphs">Graphs</h2>

<h3 id="add_graph">Add graph</h3>

There are two options for adding a graph to graphspace. A POST request to create a graph with an automatically generated id, and a PUT request to add a graph with a chosen name.

<pre>
POST -C [username]:[password] http://[% request.uri_base %]/api/users/[username]/graphs < [graph file]
</pre>

<pre>
PUT -C [username]:[password] http://[% request.uri_base %]/api/users/[username]/graph/[graphname] < [graph file]
</pre>

Example successful response:

<pre>
{
       "url" : "http://localhost:5000/users/craigy@vt.edu/graphs/866377352",
          "id" : "866377352"
}
</pre>

<!-- Example failed response:

<pre>
</pre> -->


<h3 id="get_graph">Get graph</h3>

To get the JSON for an existing graph use the following GET command. You can only get the JSON for a graph that belongs to you or is shared with a group you belong to.

<pre>
GET -C [username]:[password] http://[% request.uri_base %]/api/users/[username]/graph/[graphname]
</pre>

Example successful response:

<pre>
{
   "metadata" : {
      "name" : "foo graph",
      "tags" : ["foo", "bar"]
   },
   "graph" : {
      "data" : {
         "edges" : [
            { "source" : "2", "target" : "1", "id" : "2-1" }
         ],
         "nodes" : [
            { "label" : "A", "id" : "1" },
            { "label" : "B", "id" : "2" }
         ]
      }
   }
}
</pre>

Example failed response:

<pre>
{
   "error" : "No such graph exists"
}
</pre>


<h3 id="remove_graph">Remove graph</h3>

To remove a graph use the following command. You can only remove a graph that belongs to you.

<pre>
lwp-request -m DELETE -C [username]:[password] http://[% request.uri_base %]/api/users/[username]/graph/[graphname]
</pre>

Example successful response:

<pre>
{
       "success" : "Successfully deleted graph 866377352 owned by craigy@vt.edu."
}
</pre>

Example failed response:

<pre>
{
       "error" : "You can only delete your own graphs"
}
</pre>

<pre>
{
       "error" : "No such graph exists"
}
</pre>


<h3 id="get_user_graphs">Get user graphs</h3>

Get all ids of graphs belonging to a user. The result is a JSON object containing a list of all graph ids for the specified user.

<pre>
GET -C [username]:[password] http://[% request.uri_base %]/api/users/[username]/graphs
</pre>

Example response:

<pre>
{
   "graphs" : [
      {
         "id" : "158148980"
      }
   ]
}
</pre>

<h2 id="groups">Groups</h2>

<h3 id="get_groups">Get groups</h3>

Get the ids of all groups on the server. The result is a JSON object containing a list of all groups, including their descriptions and owners.

<pre>
GET -C [username]:[password] http://[% request.uri_base %]/api/groups
</pre>

Example response:

<pre>
{
   "groups" : [
      {
         "owner" : "craigy@vt.edu",
         "id" : "Research",
         "description" : "Research team group."
      }
   ]
}
</pre>

<h3 id="get_group">Get group</h3>

Get a group by id. The result is a JSON object with the group's id, description, and owner, as well as the list of users belonging to the group, and the list of graph ids (and the user ids for those graphs) that are shared with the group.

<pre>
GET -C [username]:[password] http://[% request.uri_base %]/api/groups/[groupid]
</pre>

Example response:

<pre>
{
   "owner" : "craigy@vt.edu",
   "graphs" : [
      {
         "id" : "158148980"
      }
   ],
   "users" : [
      {
         "id" : "craigy@vt.edu"
      }
   ],
   "id" : "Research",
   "description" : "Research team group."
}
</pre>


<h3 id="remove_group">Remove group</h3>

To remove a group use the following command. You can only remove a group that you are the owner of.

<pre>
lwp-request -m DELETE -C [username]:[password] http://[% request.uri_base %]/api/groups/[groupid]
</pre>

Example successful response:

<pre>
{
       "success" : "Successfully deleted group owned by craigy@vt.edu."
}
</pre>

Example failed response:

<pre>
{
       "error" : "You can only delete your own groups"
}
</pre>

<pre>
{
       "error" : "No such group exists"
}
</pre>


<h3 id="create_group">Create group</h3>

To create a group, use the following command. You will be the owner of the group, and you will have to set the description later.

<pre>
POST -C [username]:[password] http://[% request.uri_base %]/api/groups/[groupid]
</pre>

Example response:

<pre>
{
   "success" : "Created group newgroup."
}
</pre>


<h3 id="get_user_groups">Get groups a user belongs to</h3>

Get groups a user belongs to. The result is a JSON object with a list of group ids.

<pre>
GET -C [username]:[password] http://[% request.uri_base %]/api/users/[username]/groups
</pre>

Example response:

<pre>
{
   "groups" : [
      {
         "id" : "Research"
      }
   ]
}
</pre>

<h3 id="add_user_to_group">Add user to group</h3>

Add a user to a group. You can only add a user to a group that you belong to.

<pre>
GET -C [username]:[password] http://[% request.uri_base %]/api/groups/[groupname]/adduser/[username]
</pre>

Example successful response:

<pre>
{
   "success" : "Successfully added user test@test.com to group newgroup."
}
</pre>

<!-- Example failed response:

<pre>
</pre> -->

<h3 id="remove_user_from_group">Remove user from group</h3>

Remove a user from a group. You can remove yourself from any group, but you must be the owner of a group to remove other members.

<pre>
POST -C [username]:[password] http://[% request.uri_base %]/api/groups/[groupname]/removeuser/[username]
</pre>

Example successful response:

<pre>
{
   "success" : "Successfully removed user test@test.com from group newgroup."
}
</pre>

<!-- Example failed response:

<pre>
</pre> -->


<h3 id="share_graph">Share graph with a group</h3>

Share a graph with a group, effectively giving all members in the group read permission. You can only share graphs you own with groups you belong to.

<pre>
GET -C [username]:[password] http://[% request.uri_base %]/api/users/[username]/graphs/[graphname]/share/[groupname]
</pre>

Example successful response:

<pre>
{
   "success" : "Shared graph 491850553 owned by craigy@vt.edu with group Test."
}
</pre>

<h3 id="unshare_graph">Unshare graph with a group</h3>

Unshare a graph with a group, effectively removing read permission from all members in the group. You can only unshare graphs you own from groups you belong to.

<pre>
GET -C [username]:[password] http://[% request.uri_base %]/api/users/[username]/graphs/[graphname]/unshare/[groupname]
</pre>

Example successful response:

<pre>
{
   "success" : "Unshared graph 491850553 owned by craigy@vt.edu with group Test."
}
</pre>

{% endblock %}