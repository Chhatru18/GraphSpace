<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>graphs.util.db &mdash; GraphSpace Documentation 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="GraphSpace Documentation 0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">GraphSpace Documentation 0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for graphs.util.db</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">sqlite3</span> <span class="kn">as</span> <span class="nn">lite</span>
<span class="kn">from</span> <span class="nn">django.core.mail</span> <span class="kn">import</span> <span class="n">send_mail</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">bcrypt</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">graphs.util.json_converter</span> <span class="kn">import</span> <span class="n">convert_json</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">groupby</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="c"># Name of the database that is being used as the backend storage</span>
<span class="n">DB_NAME</span> <span class="o">=</span> <span class="s">&#39;graphspace.db&#39;</span>

<span class="c"># This file is a wrapper to communicate with sqlite3 database </span>
<span class="c"># that does not need authentication for connection</span>

<span class="c"># --------------- Edge Insertions -----------------------------------</span>


<div class="viewcode-block" id="assign_edge_ids"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.assign_edge_ids">[docs]</a><span class="k">def</span> <span class="nf">assign_edge_ids</span><span class="p">(</span><span class="n">json_string</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Modifies all id&#39;s of edges to be the names of the nodes that they are attached to.</span>

<span class="sd">		:param json_string: JSON of graph</span>
<span class="sd">		:return json_string: JSON of graph having id&#39;s for all edges</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="c"># Appending id&#39;s to all the edges using the source and target as part of its ids</span>
	<span class="c"># TODO: Change &#39;-&#39; character to something that can&#39;t be found in an edge</span>
	<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">json_string</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">]:</span>
		<span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;source&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;target&#39;</span><span class="p">]</span>

	<span class="c"># Return JSON having all edges with ids</span>
	<span class="k">return</span> <span class="n">json_string</span>

<span class="c"># Populates the edge table with edges from jsons</span>
<span class="c"># already in the database</span></div>
<div class="viewcode-block" id="insert_all_edges_from_json"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.insert_all_edges_from_json">[docs]</a><span class="k">def</span> <span class="nf">insert_all_edges_from_json</span><span class="p">():</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Inserts all edges from the JSON into the database</span>

<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">con</span><span class="o">.</span><span class="n">text_factory</span> <span class="o">=</span> <span class="nb">str</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="c"># Get information from all graphs already in the database</span>
		<span class="c"># QUERY EXAMPLE: select user_id, graph_id from graph</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select user_id, graph_id, json from graph&#39;</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="c"># If there is anything in the graph table</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="c"># Go through each Graph</span>
			<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
				<span class="k">print</span> <span class="s">&#39;Processing </span><span class="si">%s</span><span class="s"> of </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">cleaned_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
				<span class="c"># Since there are two types of JSON: one originally submitted</span>
				<span class="c"># We have to check to see if it is compatible with CytoscapeJS, if it isn&#39;t we convert it to be</span>
				<span class="c"># TODO: Remove conversion by specifying it when the user creates a graph</span>
				<span class="k">if</span> <span class="s">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">cleaned_json</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">]:</span>
					<span class="n">cleaned_json</span> <span class="o">=</span> <span class="n">assign_edge_ids</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">convert_json</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">cleaned_json</span> <span class="o">=</span> <span class="n">assign_edge_ids</span><span class="p">(</span><span class="n">cleaned_json</span><span class="p">)</span>

				<span class="c"># Go through json of the graphs, if edge is not in database, then insert it (to avoid conflicts where source and target nodes are the same).</span>
				<span class="c"># Special accomodation is done for if edge has directed property or not</span>
				<span class="c"># TODO: Remove dependency of same source and target nodes as well as directed and undirected nodes</span>
				<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">cleaned_json</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">]:</span>
					<span class="c"># TODO: Write query examples</span>
					<span class="c"># QUERY EXAMPLE: select * from edge where head_user_id=? and head_graph_id = ? and head_id = ? and tail_user_id = ? and tail_graph_id = ? and tail_id = ?, (test_user@test.com, test_graph, {graph: ...})</span>
					<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select * from edge where head_user_id=? and head_graph_id = ? and head_id = ? and tail_user_id = ? and tail_graph_id = ? and tail_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;source&#39;</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;target&#39;</span><span class="p">]))</span>
					<span class="n">sanity</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
					<span class="k">if</span> <span class="n">sanity</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">sanity</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
						<span class="k">if</span> <span class="s">&#39;directed&#39;</span> <span class="ow">in</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]:</span>
							<span class="c"># A normal edge has an edge and a tail.  However, we define as edge having a source and a target. source----&gt;target</span>
							<span class="c"># TODO: Double check Edge insertion values and write query examples</span>
							<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;insert into edge values(?,?,?,?,?,?,?,?)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;source&quot;</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;target&quot;</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;source&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;-&quot;</span> <span class="o">+</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;target&quot;</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;directed&quot;</span><span class="p">]))</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;insert into edge values(?,?,?,?,?,?,?,?)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;source&quot;</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;target&quot;</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;source&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;-&quot;</span> <span class="o">+</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;target&quot;</span><span class="p">],</span> <span class="s">&quot;&quot;</span><span class="p">))</span>

				<span class="n">cleaned_json_string</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cleaned_json</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
				<span class="c"># Update original JSON to match that with the new edge ID&#39;s</span>
				<span class="c"># TODO: Write query examples</span>
				<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;update graph set json=? where graph_id=? and user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">cleaned_json_string</span><span class="p">,</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
				<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># --------------- End Edge Insertions --------------------------------</span>
</div>
<div class="viewcode-block" id="add_everyone_to_password_reset"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.add_everyone_to_password_reset">[docs]</a><span class="k">def</span> <span class="nf">add_everyone_to_password_reset</span><span class="p">():</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Adds all users to password reset table (cold-start).</span>
<span class="sd">		Only use this once so we know crypto algorithm used </span>
<span class="sd">		for forgot password functionalities</span>

<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span> 
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select user_id from user&#39;</span><span class="p">)</span>

		<span class="n">user_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">user_data</span><span class="p">:</span>
			<span class="n">add_user_to_password_reset</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="validate_json"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.validate_json">[docs]</a><span class="k">def</span> <span class="nf">validate_json</span><span class="p">(</span><span class="n">jsonString</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		JSON Validator. Tells if the graph being inserted is </span>
<span class="sd">		valid (CytoscapeJS will render it properly).  If not, </span>
<span class="sd">		it throws an Error</span>

<span class="sd">		:param jsonString: JSON of the graph</span>
<span class="sd">		:return Errors | None: [Errors of JSON]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="c"># Validates the JSON that is uploaded to make sure</span>
	<span class="c"># it has the following properties</span>
	<span class="c"># node:</span>
	<span class="c"># label,</span>
	<span class="c"># shape,</span>
	<span class="c"># color,</span>
	<span class="c"># height,</span>
	<span class="c"># width</span>
	<span class="c"># id have to be unique</span>

	<span class="c"># edge:</span>
	<span class="c"># (dont need an id) - I auto generate one</span>
	<span class="c"># label</span>
	<span class="c"># color</span>
	<span class="c"># source</span>
	<span class="c"># target</span>
	<span class="c"># directed</span>
	<span class="c"># width</span>

	<span class="n">edge_properties</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">,</span> <span class="s">&#39;source&#39;</span><span class="p">,</span> <span class="s">&#39;target&#39;</span><span class="p">,</span> <span class="s">&#39;directed&#39;</span><span class="p">,</span> <span class="s">&#39;width&#39;</span><span class="p">]</span>
	<span class="n">node_properties</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="s">&#39;color&#39;</span><span class="p">,</span> <span class="s">&#39;shape&#39;</span><span class="p">,</span> <span class="s">&#39;height&#39;</span><span class="p">,</span> <span class="s">&#39;width&#39;</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">]</span>


	<span class="n">cleaned_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">jsonString</span><span class="p">)</span>
	<span class="c"># Since there are two types of JSON: one originally submitted</span>
	<span class="c"># We have to check to see if it is compatible with CytoscapeJS, if it isn&#39;t we convert it to be</span>
	<span class="c"># TODO: Remove conversion by specifying it when the user creates a graph</span>
	<span class="k">if</span> <span class="s">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">cleaned_json</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">]:</span>
		<span class="n">cleaned_json</span> <span class="o">=</span> <span class="n">assign_edge_ids</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">convert_json</span><span class="p">(</span><span class="n">jsonString</span><span class="p">)))</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">cleaned_json</span> <span class="o">=</span> <span class="n">assign_edge_ids</span><span class="p">(</span><span class="n">cleaned_json</span><span class="p">)</span>

	<span class="n">edges</span> <span class="o">=</span> <span class="n">cleaned_json</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">]</span>
	<span class="n">nodes</span> <span class="o">=</span> <span class="n">cleaned_json</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span>

	<span class="n">jsonErrors</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
	<span class="c"># Combines edge and node Errors</span>
	<span class="n">edgeError</span> <span class="o">=</span> <span class="n">propertyInJSON</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">edge_properties</span><span class="p">)</span>
	<span class="n">nodeError</span> <span class="o">=</span> <span class="n">propertyInJSON</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">node_properties</span><span class="p">)</span>
	<span class="n">nodeUniqueIDError</span> <span class="o">=</span> <span class="n">checkUniqueID</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
	<span class="n">nodeCheckShape</span> <span class="o">=</span> <span class="n">checkShapes</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>

	<span class="c"># If any of the above errors has &gt; 0 length, we have an error</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgeError</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">jsonErrors</span> <span class="o">+=</span> <span class="n">edgeError</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodeError</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">jsonErrors</span> <span class="o">+=</span> <span class="n">nodeError</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodeUniqueIDError</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">jsonErrors</span> <span class="o">+=</span> <span class="n">nodeUniqueIDError</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodeCheckShape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">jsonErrors</span> <span class="o">+=</span> <span class="n">nodeCheckShape</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

	<span class="k">return</span> <span class="n">jsonErrors</span>
</div>
<div class="viewcode-block" id="checkUniqueID"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.checkUniqueID">[docs]</a><span class="k">def</span> <span class="nf">checkUniqueID</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Checks to see if all of the elements in the json </span>
<span class="sd">		have unique ids</span>

<span class="sd">		:param elements: JSON of nodes or edges</span>
<span class="sd">		:return Error | None: &lt;ID for node has been dupliated!&gt;</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">id_map</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">id_map</span><span class="p">:</span>
			<span class="n">id_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&quot;Error: &quot;</span> <span class="o">+</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; for a node is duplicated!&quot;</span>

	<span class="k">return</span> <span class="s">&quot;&quot;</span>
</div>
<div class="viewcode-block" id="checkShapes"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.checkShapes">[docs]</a><span class="k">def</span> <span class="nf">checkShapes</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Checks to see if the shapes for node are valid shapes</span>

<span class="sd">		:param elements: JSON of nodes</span>
<span class="sd">		:return Error: &lt;message&gt;</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">allowed_shapes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;rectangle&quot;</span><span class="p">,</span> <span class="s">&quot;roundrectangle&quot;</span><span class="p">,</span> <span class="s">&quot;ellipse&quot;</span><span class="p">,</span> <span class="s">&quot;triangle&quot;</span><span class="p">,</span> <span class="s">&quot;pentagon&quot;</span><span class="p">,</span> <span class="s">&quot;hexagon&quot;</span><span class="p">,</span> <span class="s">&quot;heptagon&quot;</span><span class="p">,</span> <span class="s">&quot;octagon&quot;</span><span class="p">,</span> <span class="s">&quot;star&quot;</span><span class="p">]</span>

	<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;shape&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_shapes</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&quot;Error: illegal shape: &quot;</span> <span class="o">+</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;shape&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39; for a node&#39;</span>

	<span class="k">return</span> <span class="s">&quot;&quot;</span>
</div>
<div class="viewcode-block" id="propertyInJSON"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.propertyInJSON">[docs]</a><span class="k">def</span> <span class="nf">propertyInJSON</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">properties</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Checks to see if the elements in the graph JSON (nodes and edges)</span>
<span class="sd">		adhere to the properties of CytoscapeJS (ie unique ids, valid shapes)</span>

<span class="sd">		:param elements: JSON of the elements (nodes or edges)</span>
<span class="sd">		:param properties: set of properties that element JSON should following</span>
<span class="sd">		:return Error|None: &lt;Property x not in JSON for element | node&gt;</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
		<span class="n">element_data</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">element_property</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">element_property</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">element_data</span><span class="p">:</span>
				<span class="k">return</span> <span class="s">&quot;Error: Property &quot;</span> <span class="o">+</span> <span class="n">element_property</span> <span class="o">+</span>  <span class="s">&quot; not in JSON for an edge&quot;</span>

	<span class="k">return</span> <span class="s">&quot;&quot;</span>
</div>
<div class="viewcode-block" id="add_user_to_password_reset"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.add_user_to_password_reset">[docs]</a><span class="k">def</span> <span class="nf">add_user_to_password_reset</span><span class="p">(</span><span class="n">email</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Adds a specific user to password_reset table.</span>
<span class="sd">		If email is in this, it automatically sends email to change </span>
<span class="sd">		password for that account the next time the user logs on</span>

<span class="sd">		:param email: Email of the user for GraphSpace</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span> 
		<span class="c"># If email is an account on GraphSpace</span>
		<span class="k">if</span> <span class="n">emailExists</span><span class="p">(</span><span class="n">email</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
			<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select user_id from password_reset where user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="p">))</span>

			<span class="n">user_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

			<span class="c"># If user isn&#39;t already in password_reset table, add them with a new code</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

				<span class="n">code</span> <span class="o">=</span> <span class="n">id_generator</span><span class="p">()</span>
				<span class="c"># Generate a random code - used as the GET path to reset that user&#39;s password</span>
				<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;insert into password_reset values(?,?,?,?)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>

				<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="need_to_reset_password"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.need_to_reset_password">[docs]</a><span class="k">def</span> <span class="nf">need_to_reset_password</span><span class="p">(</span><span class="n">email</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Checks to see if a user needs to reset their password.</span>
<span class="sd">		If email is in password_reset email, they do, otherwise, not.</span>

<span class="sd">		:param email: Email of the user in GraphSpace</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span> 
		<span class="c"># If email is in database</span>
		<span class="k">if</span> <span class="n">emailExists</span><span class="p">(</span><span class="n">email</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
			<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

			<span class="c"># If email is in password_reset table</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select user_id from password_reset where user_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="p">))</span>

			<span class="n">user_exists</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_exists</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">True</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">False</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="id_generator"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.id_generator">[docs]</a><span class="k">def</span> <span class="nf">id_generator</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">chars</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Generates an unique alphanumeric ID of specific size.</span>

<span class="sd">		:param size: Size of random string</span>
<span class="sd">		:param chars: Subset of characters to generate random string of</span>
<span class="sd">		:return string: Random string that adhere to the parameter properties</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="is_admin"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.is_admin">[docs]</a><span class="k">def</span> <span class="nf">is_admin</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Checks to see if a given user is an admin</span>

<span class="sd">		:param username: Email of the user in GraphSpace</span>
<span class="sd">		:return boolean: True or False</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c">#Execute query to check admin for username</span>
		<span class="c"># TODO: Write query examples</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select admin from user where user_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,))</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

		<span class="c"># If user does exist and if his admin bit is set to 1, then they are an admin</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">True</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c"># Return nothing otherwise</span>
			<span class="k">return</span> <span class="bp">None</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_all_tags"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_all_tags">[docs]</a><span class="k">def</span> <span class="nf">get_all_tags</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">view_type</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets all tags for a given view_type and a username</span>

<span class="sd">		:param username: Email of the user in GraphSpace</span>
<span class="sd">		:param view_type: Type of view to filter (shared, public, owned)</span>
<span class="sd">		:return Tags: [] or None </span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Query only the tags that is the specfic view type</span>
		<span class="c"># NOTE: Changes if a person is logged in</span>
		<span class="k">if</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;public&#39;</span> <span class="ow">or</span> <span class="n">username</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
		<span class="c"># TODO: Write query examples</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct gt.tag_id from graph_to_tag as gt, graph as g where g.public = 1 and gt.graph_id = g.graph_id limit 10&#39;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;shared&#39;</span><span class="p">:</span>
		<span class="c"># TODO: Write query examples</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct gt.tag_id from graph_to_tag as gt, graph as g, group_to_graph as gg where gt.graph_id = g.graph_id and g.graph_id=gg.graph_id and gg.user_id=?limit 10&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
		<span class="c"># TODO: Write query examples</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct gt.tag_id from graph_to_tag as gt, graph as g where gt.graph_id = g.graph_id and g.user_id=? limit 10&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">))</span>

		<span class="c"># Get all the data, if there is any</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="c"># If there is data, gather all of the tags for this view type and return it</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
				<span class="n">cleaned_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">return</span> <span class="n">cleaned_data</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c"># Otherwise return Noething</span>
			<span class="k">return</span> <span class="bp">None</span>
			
	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_valid_user"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_valid_user">[docs]</a><span class="k">def</span> <span class="nf">get_valid_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Checks to see if a user/password combination exists.</span>
<span class="sd">		</span>
<span class="sd">		:param username: Email of the user in GraphSpace</span>
<span class="sd">		:param password: Password of the user</span>
<span class="sd">		:return username: &lt;Username&gt; | None if wrong information</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="c"># Retrieve hashed password of the user</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="c"># TODO: Write query examples</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select password from user where user_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,))</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

		<span class="c">#If there is no data, then user does not exist</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c"># If the hash of the passwords are not the same, then the user (theoretically) does not exist</span>
			<span class="k">if</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">hashpw</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
				<span class="k">return</span> <span class="bp">None</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c"># If everything clears </span>
				<span class="k">return</span> <span class="n">username</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="set_layout_context"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.set_layout_context">[docs]</a><span class="k">def</span> <span class="nf">set_layout_context</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Sets the entire context of a graph to be viewed.  This is needed for sending information to the front-end</span>

<span class="sd">		:param request: HTTP Request of graph to view</span>
<span class="sd">		:param context: Dictionary containing all the variables to send to the front-end</span>
<span class="sd">		:param uid: The owner of the graph</span>
<span class="sd">		:param gid: Graph name to view</span>
<span class="sd">		:return context: Filled in dictionary with all variables to send to the front-end</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">layout_to_view</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># if there is a layout specified, then render that layout</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;layout&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;layout&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;default_breadthfirst&#39;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;layout&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;default_concentric&#39;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;layout&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;default_circle&#39;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;layout&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;default_cose&#39;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;layout&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;default_cola&#39;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;layout&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;default_arbor&#39;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;layout&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;default_springy&#39;</span><span class="p">:</span>
		    <span class="n">layout_to_view</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;json&quot;</span><span class="p">:</span> <span class="n">get_layout_for_graph</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;layout&#39;</span><span class="p">),</span> <span class="n">gid</span><span class="p">,</span> <span class="n">uid</span><span class="p">)})</span> 
		<span class="k">else</span><span class="p">:</span> 
		    <span class="n">layout_to_view</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
	    <span class="n">layout_to_view</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

	<span class="c"># send layout information to the front-end</span>
	<span class="n">context</span><span class="p">[</span><span class="s">&#39;layout_to_view&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layout_to_view</span>
	<span class="n">context</span><span class="p">[</span><span class="s">&#39;layout_urls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;http://localhost:8000/graphs/&quot;</span> <span class="o">+</span> <span class="n">uid</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">gid</span> <span class="o">+</span> <span class="s">&quot;/?layout=&quot;</span>
	<span class="c"># context[&#39;layouts&#39;] = get_all_layouts_for_graph(uid, gid)</span>
	<span class="k">if</span> <span class="s">&#39;uid&#39;</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;my_layouts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_my_layouts_for_graph</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">context</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">])</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;shared_layouts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_shared_layouts_for_graph</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">context</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">])</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;my_layouts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;shared_layouts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">context</span><span class="p">[</span><span class="s">&#39;public_layouts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_public_layouts_for_graph</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">context</span>
</div>
<div class="viewcode-block" id="retrieve_cytoscape_json"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.retrieve_cytoscape_json">[docs]</a><span class="k">def</span> <span class="nf">retrieve_cytoscape_json</span><span class="p">(</span><span class="n">graphjson</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Converts JSON to CytoscapeJS standards</span>

<span class="sd">		:param graphjson: JSON of graph to render on CytoscapeJS</span>
<span class="sd">		:return JSON: CytoscapeJS-compatible graphname</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">temp_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">graphjson</span><span class="p">)[</span><span class="s">&#39;graph&#39;</span><span class="p">]</span>

    <span class="c"># for Cytoscape.js, if data is in properties, then we need to convert (main difference)</span>
	<span class="k">if</span> <span class="s">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">temp_json</span><span class="p">:</span>
	    <span class="k">return</span> <span class="n">convert_json</span><span class="p">(</span><span class="n">graphjson</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
	    <span class="k">return</span> <span class="n">graphjson</span>
</div>
<div class="viewcode-block" id="get_base_urls"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_base_urls">[docs]</a><span class="k">def</span> <span class="nf">get_base_urls</span><span class="p">(</span><span class="n">view_type</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Assigns urls to the blue buttons viewed at the graphs/ page</span>

<span class="sd">		:param view_type: Type of view (shared, public etc)</span>
<span class="sd">		:return URL: Link to the specified view_type</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="c"># Modify the url of the buttons depending on the page that the user is on</span>
	<span class="k">if</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;shared&#39;</span><span class="p">:</span>
	    <span class="k">return</span> <span class="s">&quot;http://localhost:8000/graphs/shared/&quot;</span>
	<span class="k">elif</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;public&#39;</span><span class="p">:</span>
	    <span class="k">return</span> <span class="s">&quot;http://localhost:8000/graphs/public/&quot;</span>
	<span class="k">elif</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
	    <span class="k">return</span> <span class="s">&quot;http://localhost:8000/graphs/all/&quot;</span>
	<span class="k">else</span><span class="p">:</span>
	    <span class="k">return</span> <span class="s">&quot;http://localhost:8000/graphs/&quot;</span>
</div>
<div class="viewcode-block" id="get_graphs_for_view_type"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_graphs_for_view_type">[docs]</a><span class="k">def</span> <span class="nf">get_graphs_for_view_type</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">view_type</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">search_terms</span><span class="p">,</span> <span class="n">tag_terms</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the graphs that are associated with a certain view from the user</span>
<span class="sd">		</span>
<span class="sd">		:param context: Dictionary containing values to pass to front-end</span>
<span class="sd">		:param view_type: Type of view to render</span>
<span class="sd">		:param uid: Owner of the graph</span>
<span class="sd">		:param search_terms: Criteria that to filter graphs </span>
<span class="sd">		:param tag_terms: Only display graphs with these tags</span>
<span class="sd">		:return context: Dictionary containing values to pass to front-end</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">tag_list</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">search_list</span> <span class="o">=</span> <span class="p">[]</span>
	
	<span class="c"># modify tag information </span>
	<span class="k">if</span> <span class="n">tag_terms</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_terms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">cleaned_tags</span> <span class="o">=</span> <span class="n">tag_terms</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
		<span class="n">client_side_tags</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
		<span class="c"># Goes through each tag, making it a string</span>
		<span class="c"># so the url will contain those tags as a part</span>
		<span class="c"># of the query string</span>
		<span class="k">for</span> <span class="n">tags</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned_tags</span><span class="p">)):</span>
		    <span class="n">cleaned_tags</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span> <span class="o">=</span> <span class="n">cleaned_tags</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
		    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned_tags</span><span class="p">[</span><span class="n">tags</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		    	<span class="k">del</span> <span class="n">cleaned_tags</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span>
		    <span class="n">client_side_tags</span> <span class="o">=</span> <span class="n">client_side_tags</span> <span class="o">+</span> <span class="n">cleaned_tags</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span>

		<span class="n">client_side_tags</span> <span class="o">=</span> <span class="n">client_side_tags</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">client_side_tags</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;tags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">client_side_tags</span>
		<span class="c"># This is for the side menu, each tag has its own button</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;tag_terms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cleaned_tags</span>
		<span class="n">tag_list</span> <span class="o">=</span> <span class="n">cleaned_tags</span>

    <span class="c"># modify search information</span>
	<span class="k">if</span> <span class="n">search_terms</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_terms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;search_result&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
		<span class="n">cleaned_search_terms</span> <span class="o">=</span> <span class="n">search_terms</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
		<span class="n">client_side_search</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
		<span class="c"># Goes through each search term, making it a string</span>
		<span class="c"># so the url will contain those searches as a part</span>
		<span class="c"># of the query string</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned_search_terms</span><span class="p">)):</span>
			<span class="n">cleaned_search_terms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cleaned_search_terms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
			<span class="c"># Deleted no length search terms</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned_search_terms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">del</span> <span class="n">cleaned_search_terms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="c"># This is for the side menu, each search item has its own button</span>
			<span class="n">client_side_search</span> <span class="o">=</span> <span class="n">client_side_search</span> <span class="o">+</span> <span class="n">cleaned_search_terms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span>

		<span class="n">client_side_search</span> <span class="o">=</span> <span class="n">client_side_search</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">client_side_search</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;search_word&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">client_side_search</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;search_word_terms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cleaned_search_terms</span>
		<span class="n">search_list</span> <span class="o">=</span> <span class="n">cleaned_search_terms</span>

	<span class="c"># If there is no one logged in, display only public graph results</span>
	<span class="k">if</span> <span class="n">uid</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;graph_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">view_graphs</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_terms</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">,</span> <span class="s">&#39;public&#39;</span><span class="p">)</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;my_graphs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;shared_graphs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">if</span> <span class="n">context</span><span class="p">[</span><span class="s">&#39;graph_list&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">context</span><span class="p">[</span><span class="s">&#39;public_graphs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">context</span><span class="p">[</span><span class="s">&#39;public_graphs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;graph_list&#39;</span><span class="p">])</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;graph_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">view_graphs</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_list</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">,</span> <span class="n">view_type</span><span class="p">)</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;my_graphs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">view_graphs</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_list</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">,</span> <span class="s">&#39;my graphs&#39;</span><span class="p">))</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;shared_graphs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">view_graphs</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_list</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">,</span> <span class="s">&#39;shared&#39;</span><span class="p">))</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;public_graphs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">view_graphs</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_list</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">,</span> <span class="s">&#39;public&#39;</span><span class="p">))</span>

	<span class="k">return</span> <span class="n">context</span>
</div>
<div class="viewcode-block" id="view_graphs"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.view_graphs">[docs]</a><span class="k">def</span> <span class="nf">view_graphs</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_terms</span><span class="p">,</span> <span class="n">tag_terms</span><span class="p">,</span> <span class="n">view_type</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the graphs that are associated with a certain view from the user</span>
<span class="sd">		</span>
<span class="sd">		:param uid: Owner of the graph</span>
<span class="sd">		:param search_terms: Criteria that to filter graphs </span>
<span class="sd">		:param tag_terms: Only display graphs with these tags</span>
<span class="sd">		:return context: Dictionary containing values to pass to front-end</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">actual_graphs</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="k">if</span> <span class="n">search_terms</span><span class="p">:</span>
		<span class="c"># Graphs that match the searches</span>
		<span class="n">search_result_graphs</span> <span class="o">=</span> <span class="n">search_result</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_terms</span><span class="p">,</span> <span class="n">view_type</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">tag_terms</span><span class="p">:</span>
		<span class="c"># Graphs that match the tag results</span>
		<span class="n">tag_result_graphs</span> <span class="o">=</span> <span class="n">tag_result</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">tag_terms</span><span class="p">,</span> <span class="n">view_type</span><span class="p">)</span>

	<span class="c"># If there are graphs that fit search and tag criteria</span>
	<span class="k">if</span> <span class="n">search_terms</span> <span class="ow">and</span> <span class="n">tag_terms</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_terms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_terms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">tag_graphs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tag_result_graphs</span><span class="p">]</span>
		<span class="n">actual</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">actual_graphs</span><span class="p">]</span>

		<span class="c"># If it is not already part of final graphs returned, add it in</span>
		<span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">search_result_graphs</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">graph</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">tag_graphs</span> <span class="ow">and</span> <span class="n">graph</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">actual</span><span class="p">:</span>
				<span class="n">actual_graphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">actual_graphs</span>

	<span class="c"># If there are only tag terms</span>
	<span class="k">elif</span> <span class="n">tag_terms</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_terms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">tag_result_graphs</span>
	<span class="c"># If there are only search terms</span>
	<span class="k">elif</span> <span class="n">search_terms</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_terms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">search_result_graphs</span>
	<span class="c"># Just display the graphs</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">view_graphs_of_type</span><span class="p">(</span><span class="n">view_type</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
		</div>
<div class="viewcode-block" id="tag_result"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.tag_result">[docs]</a><span class="k">def</span> <span class="nf">tag_result</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">tag_terms</span><span class="p">,</span> <span class="n">view_type</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets all graphs that contain the specified tags for a user and a view_type.</span>

<span class="sd">		:param uid: Owner of graph</span>
<span class="sd">		:param tag_terms: Tags that all graphs must contain</span>
<span class="sd">		:param view_type: Type of view to display the graphs in (shared, public)</span>
<span class="sd">		:return Graphs: [graphs]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_terms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="c"># Place holder that stores all the graphs</span>
		<span class="n">initial_graphs_with_tags</span> <span class="o">=</span> <span class="p">[]</span>	
		<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="k">try</span><span class="p">:</span> 
			<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
			<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

			<span class="c"># Go through all the tag terms, based on the view type and append them the initial place holder</span>
			<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tag_terms</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;my graphs&#39;</span><span class="p">:</span>
					<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select g.graph_id, g.modified, g.user_id, g.public from graph as g, graph_to_tag as gt where gt.graph_id = g.graph_id and gt.tag_id = ? and gt.user_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">uid</span><span class="p">))</span>
					
				<span class="k">elif</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;shared&#39;</span><span class="p">:</span>
					<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct g.graph_id, g.modified, g.user_id, g.public from group_to_user as gu, graph as g, graph_to_tag as gt, group_to_graph as gg where gg.group_id = gu.group_id and gt.graph_id=g.graph_id and gg.graph_id=g.graph_id and gt.tag_id = ? and gu.user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">uid</span><span class="p">))</span>
					
				<span class="k">else</span><span class="p">:</span>
					<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select g.graph_id, g.modified, g.user_id, g.public from graph as g, graph_to_tag as gt where gt.graph_id = g.graph_id and gt.tag_id = ? and g.public = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

				<span class="c"># After the current SQL is executed, collect the results</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
					<span class="n">initial_graphs_with_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

			<span class="c"># After all the SQL statements have ran for all of the tags, count the number of times</span>
			<span class="c"># a graph appears in the initial list. If it appears as many times as there are </span>
			<span class="c"># tag terms, then that graph matches all the tag terms and it should be returned</span>
			<span class="n">graph_repititions</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
			<span class="n">graph_mappings</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
			<span class="c"># Counting the number of occurences</span>
			<span class="k">for</span> <span class="n">graph_tuple</span> <span class="ow">in</span> <span class="n">initial_graphs_with_tags</span><span class="p">:</span>
				<span class="n">graph_repititions</span><span class="p">[</span><span class="n">graph_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

			<span class="k">for</span> <span class="n">graph_tuple</span> <span class="ow">in</span> <span class="n">initial_graphs_with_tags</span><span class="p">:</span>
				<span class="n">graph_list</span> <span class="o">=</span> <span class="n">graph_mappings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">graph_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[])</span>
				<span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph_tuple</span><span class="p">)</span>
				<span class="n">graph_mappings</span><span class="p">[</span><span class="n">graph_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">graph_list</span>

			<span class="c"># If value appears the number of times as there are tags, </span>
			<span class="c"># then append that to the actual list of graphs to be returned.</span>
			<span class="n">actual_graphs_for_tags</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">graph_repititions</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_terms</span><span class="p">):</span>
					<span class="n">key_tuples</span> <span class="o">=</span> <span class="n">graph_mappings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
					<span class="k">for</span> <span class="n">key_tuple</span> <span class="ow">in</span> <span class="n">key_tuples</span><span class="p">:</span>
						<span class="c"># Insert all tags for the graph in the first index</span>
						<span class="n">key_with_tag</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">key_tuple</span><span class="p">)</span>
						<span class="n">key_with_tag</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">get_all_tags_for_graph</span><span class="p">(</span><span class="n">key_with_tag</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key_with_tag</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
						<span class="n">key_with_tag</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">key_with_tag</span><span class="p">)</span>
						<span class="n">actual_graphs_for_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key_with_tag</span><span class="p">)</span>

			<span class="k">return</span> <span class="n">actual_graphs_for_tags</span>

		<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">return</span> <span class="p">[]</span>
		<span class="k">finally</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
				<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="search_result"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.search_result">[docs]</a><span class="k">def</span> <span class="nf">search_result</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_terms</span><span class="p">,</span> <span class="n">view_type</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the graphs that match the search terms and the view type.</span>

<span class="sd">		:param uid: Owner of the graph</span>
<span class="sd">		:param search_terms: Terms to search for</span>
<span class="sd">		:param view_type: Type of view to render the graphs for</span>
<span class="sd">		:return Graphs: [graphs]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="c"># Make into list if it is not a lsit</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">search_terms</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
		<span class="n">search_terms</span> <span class="o">=</span> <span class="n">search_terms</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_terms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">intial_graphs_from_search</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="k">try</span><span class="p">:</span> 
			<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
			<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

			<span class="c"># If it is an edge</span>
			<span class="k">for</span> <span class="n">search_word</span> <span class="ow">in</span> <span class="n">search_terms</span><span class="p">:</span>
				<span class="k">if</span> <span class="s">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">search_word</span><span class="p">:</span>
					<span class="n">intial_graphs_from_search</span> <span class="o">=</span> <span class="n">intial_graphs_from_search</span> <span class="o">+</span> <span class="n">find_edges</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_word</span><span class="p">,</span> <span class="n">view_type</span><span class="p">,</span> <span class="n">cur</span><span class="p">)</span>
				<span class="c"># If it is a node or possibly a graph_id (name of the graph)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">intial_graphs_from_search</span> <span class="o">=</span> <span class="n">intial_graphs_from_search</span> <span class="o">+</span> <span class="n">find_nodes</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_word</span><span class="p">,</span> <span class="n">view_type</span><span class="p">,</span> <span class="n">cur</span><span class="p">)</span> <span class="o">+</span> <span class="n">find_graphs_using_names</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_word</span><span class="p">,</span> <span class="n">view_type</span><span class="p">,</span> <span class="n">cur</span><span class="p">)</span>

			<span class="c"># After all the SQL statements have ran for all of the search_terms, count the number of times</span>
			<span class="c"># a graph appears in the initial list. If it appears as many times as there are </span>
			<span class="c"># search terms, then that graph matches all the tag terms and it should be returned</span>
			<span class="n">graph_repititions</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
			<span class="n">graph_mappings</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
			<span class="c"># Counting the number of occurences</span>
			<span class="k">for</span> <span class="n">graph_tuple</span> <span class="ow">in</span> <span class="n">intial_graphs_from_search</span><span class="p">:</span>
				<span class="n">graph_repititions</span><span class="p">[</span><span class="n">graph_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">graph_tuple</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

			<span class="k">for</span> <span class="n">graph_tuple</span> <span class="ow">in</span> <span class="n">intial_graphs_from_search</span><span class="p">:</span>
				<span class="n">graph_list</span> <span class="o">=</span> <span class="n">graph_mappings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">graph_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">graph_tuple</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="p">[])</span>
				<span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph_tuple</span><span class="p">)</span>
				<span class="n">graph_mappings</span><span class="p">[</span><span class="n">graph_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">graph_tuple</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span> <span class="o">=</span> <span class="n">graph_list</span>

			<span class="c"># If value appears the number of times as there are tags, </span>
			<span class="c"># then append that to the actual list of graphs to be returned.</span>
			<span class="n">actual_graphs_for_searches</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">graph_repititions</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_terms</span><span class="p">):</span>
					<span class="n">key_tuples</span> <span class="o">=</span> <span class="n">graph_mappings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
					<span class="n">ids_and_labels</span> <span class="o">=</span> <span class="p">[]</span>
					<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
					<span class="c"># Gather all the id&#39;s and labels that are part of the same graph </span>
					<span class="c"># that is being searched for and make them into one tuple</span>
					<span class="k">for</span> <span class="n">key_tuple</span> <span class="ow">in</span> <span class="n">key_tuples</span><span class="p">:</span>
						<span class="n">key_with_search</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">key_tuple</span><span class="p">)</span>
						<span class="n">ids_and_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
						<span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key_tuple</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
					<span class="n">id_string</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
					<span class="k">for</span> <span class="n">ids</span> <span class="ow">in</span> <span class="n">ids_and_labels</span><span class="p">:</span>
						<span class="n">id_string</span> <span class="o">=</span> <span class="n">id_string</span> <span class="o">+</span> <span class="n">ids</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
					<span class="n">id_string</span> <span class="o">=</span> <span class="n">id_string</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">id_string</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
					<span class="n">label_string</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
					<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
						<span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="p">)</span>
						<span class="n">label_string</span> <span class="o">=</span> <span class="n">label_string</span> <span class="o">+</span> <span class="n">label</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span>
					<span class="n">label_string</span> <span class="o">=</span> <span class="n">label_string</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">label_string</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
					<span class="n">key_with_search</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">key_tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
					<span class="c"># Append all tags for the graph</span>
					<span class="n">key_with_search</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">get_all_tags_for_graph</span><span class="p">(</span><span class="n">key_with_search</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key_with_search</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
					<span class="n">key_with_search</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">id_string</span>
					<span class="n">key_with_search</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_string</span>
					<span class="n">key_with_search</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">key_with_search</span><span class="p">)</span>
					<span class="n">actual_graphs_for_searches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key_with_search</span><span class="p">)</span>

			<span class="c"># Return whole dictionary of matchin graphs</span>
			<span class="k">return</span> <span class="n">actual_graphs_for_searches</span>

		<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">return</span> <span class="p">[]</span>
		<span class="k">finally</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
				<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="find_edges"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.find_edges">[docs]</a><span class="k">def</span> <span class="nf">find_edges</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_word</span><span class="p">,</span> <span class="n">view_type</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Finds graphs that have the edges that are being searched for.</span>

<span class="sd">		:param uid: Owner of the graph</span>
<span class="sd">		:param search_word: Edge being searched for</span>
<span class="sd">		:param view_type: Type of view to limit the graphs to</span>
<span class="sd">		:param cur: Database cursor</span>
<span class="sd">		:return Edges: [Edges]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">initial_graphs_with_edges</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">node_ids</span> <span class="o">=</span> <span class="n">search_word</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>

	<span class="n">head_node</span> <span class="o">=</span> <span class="n">node_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">tail_node</span> <span class="o">=</span> <span class="n">node_ids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

	<span class="c"># treat id&#39;s as labels</span>
	<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select n.node_id from node as n where n.label = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">head_node</span><span class="p">,</span> <span class="p">))</span>
	<span class="n">head_node_label_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
	<span class="n">head_node_ids</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">head_node_label_data</span><span class="p">:</span>
		<span class="n">head_node_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

	<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select n.node_id from node as n where n.label = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tail_node</span><span class="p">,</span> <span class="p">))</span>
	<span class="n">tail_node_label_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
	<span class="n">tail_node_ids</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">tail_node_label_data</span><span class="p">:</span>
		<span class="n">tail_node_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

	<span class="c"># treat id&#39;s as node_id&#39;s</span>
	<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select n.node_id from node as n where n.node_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">head_node</span><span class="p">,</span> <span class="p">))</span>
	<span class="n">head_node_id_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">head_node_id_data</span><span class="p">:</span>
		<span class="n">head_node_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

	<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select n.node_id from node as n where n.node_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tail_node</span><span class="p">,</span> <span class="p">))</span>
	<span class="n">tail_node_id_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">tail_node_id_data</span><span class="p">:</span>
		<span class="n">tail_node_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

	<span class="n">head_node_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">head_node_ids</span><span class="p">))</span>
	<span class="n">tail_node_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tail_node_ids</span><span class="p">))</span>

	<span class="c"># If there are any graphs that fit the criteria, </span>
	<span class="c"># return the graphs that are under the type of graphs</span>
	<span class="c"># that the user wants to see (his/her graphs, or public etc)</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">head_node_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tail_node_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">head_node_ids</span><span class="p">)):</span>
			<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tail_node_ids</span><span class="p">)):</span>
				<span class="k">if</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;public&#39;</span><span class="p">:</span>
					<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select e.head_graph_id, e.head_id, e.label, g.modified, e.head_user_id, g.public from edge as e, graph as g where e.head_id = ? and e.tail_id = ? and e.head_graph_id = g.graph_id and g.public = 1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">head_node_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tail_node_ids</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
				<span class="k">elif</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;shared&#39;</span><span class="p">:</span>
					<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select e.head_graph_id, e.head_id, e.label, g.modified, e.head_user_id, g.public from edge as e, graph as g, group_to_graph as gg where gg.user_id = ? and e.head_graph_id = gg.graph_id and e.head_id = ? and e.tail_id = ? and e.head_graph_id = g.graph_id&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">head_node_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tail_node_ids</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select e.head_graph_id, e.head_id, e.label, g.modified, e.head_user_id, g.public from edge as e, graph as g where e.head_user_id = ? and e.head_graph_id = g.graph_id and e.head_id = ? and e.tail_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">head_node_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tail_node_ids</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>

				<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
				<span class="n">initial_graphs_with_edges</span> <span class="o">=</span> <span class="n">add_unique_to_list</span><span class="p">(</span><span class="n">initial_graphs_with_edges</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
				
	<span class="n">actual_graph_with_edges</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">initial_graphs_with_edges</span><span class="p">:</span>
		<span class="n">graph_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
		<span class="c"># Appending the nodes that are being searched for</span>
		<span class="n">graph_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39; (&#39;</span> <span class="o">+</span> <span class="n">head_node</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="n">tail_node</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
		<span class="n">actual_graph_with_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">graph_list</span><span class="p">))</span>

	<span class="k">return</span> <span class="n">actual_graph_with_edges</span>
</div>
<div class="viewcode-block" id="find_edge"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.find_edge">[docs]</a><span class="k">def</span> <span class="nf">find_edge</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">edge_to_find</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Finds the id of the edge inside graph</span>
<span class="sd">		Used for highlighting elements inside the graph</span>

<span class="sd">		:param uid: Owner of graph</span>
<span class="sd">		:param gid: Name of graph that is being viewed</span>
<span class="sd">		:param edge_to_find: Edge that is being searched for</span>
<span class="sd">		:return ID: [ID of edge]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="n">head_node</span> <span class="o">=</span> <span class="n">edge_to_find</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">tail_node</span> <span class="o">=</span> <span class="n">edge_to_find</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

		<span class="c"># Find node id&#39;s that are being searched for (source and target nodes)</span>
		<span class="n">head_node</span> <span class="o">=</span> <span class="n">find_node</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">head_node</span><span class="p">)</span>
		<span class="n">tail_node</span> <span class="o">=</span> <span class="n">find_node</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">tail_node</span><span class="p">)</span>

		<span class="c"># If both nodes exist, find label between them</span>
		<span class="k">if</span> <span class="n">tail_node</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">head_node</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select label from edge where tail_id = ? and head_id = ? and head_user_id = ? and head_graph_id = ? limit 1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tail_node</span><span class="p">,</span> <span class="n">head_node</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">))</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
			<span class="c"># If something exists, return the ids of the paents</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="find_node"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.find_node">[docs]</a><span class="k">def</span> <span class="nf">find_node</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">node_to_find</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Finds the id of the node inside graph</span>
<span class="sd">		Used for highlighting elements inside the graph</span>

<span class="sd">		:param uid: Owner of graph</span>
<span class="sd">		:param gid: Name of graph that is being viewed</span>
<span class="sd">		:param node_to_find: Node that is being searched for</span>
<span class="sd">		:return ID: [ID of node]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">id_of_node</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Get the id of the node (could be id or a label) and return it if they exist</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select node_id from node where node_id= ? and user_id = ? and graph_id = ? limit 1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">node_to_find</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">))</span>
		<span class="n">id_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">id_data</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">id_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select node_id from node where label = ? and user_id = ? and graph_id = ? limit 1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">node_to_find</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">))</span>
			<span class="n">label_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">label_data</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">label_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">label_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">None</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="find_nodes"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.find_nodes">[docs]</a><span class="k">def</span> <span class="nf">find_nodes</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_word</span><span class="p">,</span> <span class="n">view_type</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Finds graphs that have the nodes that are being searched for.</span>

<span class="sd">		:param uid: Owner of the graph</span>
<span class="sd">		:param search_word: Node being searched for</span>
<span class="sd">		:param view_type: Type of view to limit the graphs to</span>
<span class="sd">		:param cur: Database cursor</span>
<span class="sd">		:return Nodes: [Nodes]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">intial_graph_with_nodes</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="k">if</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;my graphs&#39;</span><span class="p">:</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select n.graph_id, n.node_id, n.label, g.modified, n.user_id, g.public from node as n, graph as g where n.label = ? and n.graph_id = g.graph_id and n.user_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">search_word</span><span class="p">,</span> <span class="n">uid</span><span class="p">))</span>
		<span class="n">node_labels</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="n">intial_graph_with_nodes</span> <span class="o">=</span> <span class="n">add_unique_to_list</span><span class="p">(</span><span class="n">intial_graph_with_nodes</span><span class="p">,</span> <span class="n">node_labels</span><span class="p">)</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select n.graph_id, n.node_id, n.label, g.modified, n.user_id, g.public from node as n, graph as g where n.node_id = ? and n.graph_id = g.graph_id and n.user_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">search_word</span><span class="p">,</span> <span class="n">uid</span><span class="p">))</span>
		<span class="n">node_ids</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="n">intial_graph_with_nodes</span> <span class="o">=</span> <span class="n">add_unique_to_list</span><span class="p">(</span><span class="n">intial_graph_with_nodes</span><span class="p">,</span> <span class="n">node_ids</span><span class="p">)</span>

	<span class="k">elif</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;shared&#39;</span><span class="p">:</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select n.graph_id, n.node_id, n.label, g.modified, n.user_id, g.public from node as n, group_to_graph as gg, graph as g where n.label =? and gg.graph_id == n.graph_id and n.user_id= ? and n.user_id == gg.user_id&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">search_word</span><span class="p">,</span> <span class="n">uid</span><span class="p">))</span>
		<span class="n">shared_labels</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="n">intial_graph_with_nodes</span> <span class="o">=</span> <span class="n">add_unique_to_list</span><span class="p">(</span><span class="n">intial_graph_with_nodes</span><span class="p">,</span> <span class="n">shared_labels</span><span class="p">)</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select n.graph_id, n.node_id, n.label, g.modified, n.user_id, g.public from node as n, group_to_graph as gg, graph as g where n.node_id =? and gg.graph_id == n.graph_id and n.user_id= ? and n.user_id == gg.user_id&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">search_word</span><span class="p">,</span> <span class="n">uid</span><span class="p">))</span>
		<span class="n">shared_ids</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="n">intial_graph_with_nodes</span> <span class="o">=</span> <span class="n">add_unique_to_list</span><span class="p">(</span><span class="n">intial_graph_with_nodes</span><span class="p">,</span> <span class="n">shared_ids</span><span class="p">)</span>

	<span class="k">else</span><span class="p">:</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select n.graph_id, n.node_id, n.label, g.modified, n.user_id, g.public from node as n, graph as g where n.label = ? and n.graph_id = g.graph_id and g.public = 1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">search_word</span><span class="p">,</span> <span class="p">))</span>
		<span class="n">public_labels</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="n">intial_graph_with_nodes</span> <span class="o">=</span> <span class="n">add_unique_to_list</span><span class="p">(</span><span class="n">intial_graph_with_nodes</span><span class="p">,</span> <span class="n">public_labels</span><span class="p">)</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select n.graph_id, n.node_id, n.label, g.modified, n.user_id, g.public from node as n, graph as g where n.node_id = ? and n.graph_id = g.graph_id and g.public = 1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">search_word</span><span class="p">,</span> <span class="p">))</span>
		<span class="n">public_ids</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="n">intial_graph_with_nodes</span> <span class="o">=</span> <span class="n">add_unique_to_list</span><span class="p">(</span><span class="n">intial_graph_with_nodes</span><span class="p">,</span> <span class="n">public_ids</span><span class="p">)</span>

	<span class="n">actual_graph_with_nodes</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">intial_graph_with_nodes</span><span class="p">:</span>
		<span class="n">graph_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
		<span class="n">graph_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39; (&#39;</span> <span class="o">+</span> <span class="n">graph_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
		<span class="n">actual_graph_with_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">graph_list</span><span class="p">))</span>

	<span class="k">return</span> <span class="n">actual_graph_with_nodes</span>
</div>
<div class="viewcode-block" id="find_graphs_using_names"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.find_graphs_using_names">[docs]</a><span class="k">def</span> <span class="nf">find_graphs_using_names</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">search_word</span><span class="p">,</span> <span class="n">view_type</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;	</span>
<span class="sd">		Finds graphs that have the matching graph name.</span>

<span class="sd">		:param uid: Owner of the graph</span>
<span class="sd">		:param search_word: Graph names being searched for</span>
<span class="sd">		:param view_type: Type of view to limit the graphs to</span>
<span class="sd">		:param cur: Database cursor</span>
<span class="sd">		:return Graphs: [Graphs]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">intial_graph_names</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">actual_graph_names</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="k">if</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;my graphs&#39;</span><span class="p">:</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select g.graph_id, g.modified, g.user_id, g.public from graph as g where g.graph_id = ? and g.user_id= ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">search_word</span><span class="p">,</span> <span class="n">uid</span><span class="p">))</span>
	<span class="k">elif</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;shared&#39;</span><span class="p">:</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select g.graph_id, g.modified, g.user_id, g.public from graph as g, group_to_graph as gg where g.graph_id = ? and g.user_id= ? and g.user_id = gg.user_id and g.graph_id = gg.graph_id&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">search_word</span><span class="p">,</span> <span class="n">uid</span><span class="p">))</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select g.graph_id, g.modified, g.user_id, g.public from graph as g where g.graph_id = ? and g.public= 1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">search_word</span><span class="p">,</span> <span class="p">))</span>

	<span class="n">graph_list</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
	<span class="c"># Get all unique graphs</span>
	<span class="n">intial_graph_names</span> <span class="o">=</span> <span class="n">add_unique_to_list</span><span class="p">(</span><span class="n">intial_graph_names</span><span class="p">,</span> <span class="n">graph_list</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">intial_graph_names</span><span class="p">:</span>
		<span class="n">graph_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
		<span class="c"># Appened nothing so that the table will be displayed properly</span>
		<span class="n">graph_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">graph_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">actual_graph_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">graph_list</span><span class="p">))</span>
		
	<span class="k">return</span> <span class="n">actual_graph_names</span>

</div>
<div class="viewcode-block" id="add_unique_to_list"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.add_unique_to_list">[docs]</a><span class="k">def</span> <span class="nf">add_unique_to_list</span><span class="p">(</span><span class="n">listname</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Adds all unique items to the specified list</span>
<span class="sd">		Also checks to see if the length is &gt; 0 for each item</span>
<span class="sd">		inserted into the list</span>

<span class="sd">		:param listname: List to put unique elements in</span>
<span class="sd">		:param data: Possible duplicate data to search through</span>
<span class="sd">		:return listname: [Unique elements]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">listname</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">listname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">listname</span>


<span class="c"># -------------------------- REST API -------------------------------</span>
</div>
<div class="viewcode-block" id="insert_graph"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.insert_graph">[docs]</a><span class="k">def</span> <span class="nf">insert_graph</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">graphname</span><span class="p">,</span> <span class="n">graph_json</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		# TODO: Add rest call example</span>
<span class="sd">		Inserts a uniquely named graph under a username.</span>

<span class="sd">		:param username: Email of user in GraphSpace</span>
<span class="sd">		:param graphname: Name of graph to insert</span>
<span class="sd">		:param graph_json: JSON of graph</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="c"># TODO: Write query examples</span>
		<span class="c"># Checks to see if a user already has a graph with the same name under his account</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select graph_id from graph where user_id = ? and graph_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">graphname</span><span class="p">))</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

		<span class="c"># If not, add this graph to his account</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">validationErrors</span> <span class="o">=</span> <span class="n">validate_json</span><span class="p">(</span><span class="n">graph_json</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">validationErrors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">validationErrors</span>

			<span class="n">curTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
			<span class="n">graphJson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">graph_json</span><span class="p">)</span>

			<span class="c"># Checks to see if it is compatible with CytoscapeJS and converts it accordingly</span>
			<span class="c"># TODO: Delete this after Verifier is finished</span>
			<span class="k">if</span> <span class="s">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">graphJson</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">]:</span>
				<span class="n">graphJson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">convert_json</span><span class="p">(</span><span class="n">graph_json</span><span class="p">))</span>

			<span class="c"># Attach ID&#39;s to each edge for traversing the element</span>
			<span class="n">graphJson</span> <span class="o">=</span> <span class="n">assign_edge_ids</span><span class="p">(</span><span class="n">graphJson</span><span class="p">)</span>

			<span class="c"># Go through all the nodes in the JSON and if they don&#39;t have a label,</span>
			<span class="c"># Append a random label to it</span>
			<span class="c"># Used so that I can highlight the node</span>
			<span class="c"># TODO: double check this because I may need to get the id and not the label</span>
			<span class="n">nodes</span> <span class="o">=</span> <span class="n">graphJson</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span>
			<span class="n">rand</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">node</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rand</span>
					<span class="n">rand</span> <span class="o">=</span> <span class="n">rand</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="n">rand</span> <span class="o">=</span> <span class="mi">0</span>

			<span class="c"># Inserts it into the database, all graphs inserted are private for now</span>
			<span class="c"># TODO: Verify if that is what I want</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;insert into graph values(?, ?, ?, ?, ?, ?, ?)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">graphname</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">graphJson</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">curTime</span><span class="p">,</span> <span class="n">curTime</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

			<span class="n">tags</span> <span class="o">=</span> <span class="n">graphJson</span><span class="p">[</span><span class="s">&#39;metadata&#39;</span><span class="p">][</span><span class="s">&#39;tags&#39;</span><span class="p">]</span>

			<span class="c"># Insert all tags for this graph into tags database</span>
			<span class="n">insert_data_for_graph</span><span class="p">(</span><span class="n">graphJson</span><span class="p">,</span> <span class="n">graphname</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>
			<span class="c"># Commit the changes</span>
			<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

			<span class="c"># If everything works, return Nothing </span>
			<span class="k">return</span> <span class="bp">None</span>
	
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&#39;Graph &#39;</span> <span class="o">+</span> <span class="n">graphname</span> <span class="o">+</span> <span class="s">&#39; already exists for &#39;</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">&#39;!&#39;</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="insert_data_for_graph"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.insert_data_for_graph">[docs]</a><span class="k">def</span> <span class="nf">insert_data_for_graph</span><span class="p">(</span><span class="n">graphJson</span><span class="p">,</span> <span class="n">graphname</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">con</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Inserts metadata about a graph into its respective tables.</span>

<span class="sd">		:param graphJson: JSON of graph</span>
<span class="sd">		:param graphname: Name of graph</span>
<span class="sd">		:username: Name of user</span>
<span class="sd">		:param: Tags of graph</span>
<span class="sd">		:param Nodes: Nodes to insert into nodes table</span>
<span class="sd">		:param cur: Database cursor</span>
<span class="sd">		:param con: Database connection</span>
<span class="sd">	&#39;&#39;&#39;</span>
	
	<span class="c"># Add all tags for this graph into graph_tag and graph_to_tag tables</span>
	<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
		<span class="c"># TODO: Query example</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select tag_id from graph_tag where tag_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="p">))</span>
		<span class="n">tagData</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">tagData</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;insert into graph_tag values(?)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="p">))</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;insert into graph_to_tag values(?,?,?)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">graphname</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

	<span class="n">edges</span> <span class="o">=</span> <span class="n">graphJson</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">]</span>

	<span class="c"># Add all edges and nodes in the JSON to their respective tables</span>
	<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;insert into edge values(?,?,?,?,?,?,?,?)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">graphname</span><span class="p">,</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;source&quot;</span><span class="p">],</span> <span class="n">graphname</span><span class="p">,</span> <span class="n">graphname</span><span class="p">,</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;target&quot;</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;source&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;-&quot;</span> <span class="o">+</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;target&quot;</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&quot;directed&quot;</span><span class="p">]))</span>

	<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;insert into node values(?,?,?,?)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">],</span> <span class="n">username</span><span class="p">,</span> <span class="n">graphname</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="get_graph_json"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_graph_json">[docs]</a><span class="k">def</span> <span class="nf">get_graph_json</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">graphname</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get the JSON of the graph to view.</span>

<span class="sd">		:param username: Email of user in GraphSpace</span>
<span class="sd">		:param password: Password of the user</span>
<span class="sd">		:return JSON: JSON of graph to view</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Return the JSON of the graph that matches the username and the graphname</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select json from graph where user_id = ? and graph_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">graphname</span><span class="p">))</span>

		<span class="n">jsonData</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

		<span class="c"># If there is JSON for this graph, return it</span>
		<span class="k">if</span> <span class="n">jsonData</span> <span class="ow">and</span> <span class="n">jsonData</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
			<span class="k">return</span> <span class="n">jsonData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="delete_graph"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.delete_graph">[docs]</a><span class="k">def</span> <span class="nf">delete_graph</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">graphname</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Deletes graph from database.</span>

<span class="sd">		:param username: Email of user in GraphSpace</span>
<span class="sd">		:param password: Password of the user</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Deletes information about a graph from all the tables that reference it</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;delete from graph where user_id = ? and graph_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">graphname</span><span class="p">))</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;delete from graph_to_tag where graph_id=? and user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">graphname</span><span class="p">,</span> <span class="n">username</span><span class="p">))</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;delete from edge where head_graph_id =? and head_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">graphname</span><span class="p">,</span> <span class="n">username</span><span class="p">))</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;delete from node where graph_id = ? and user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">graphname</span><span class="p">,</span> <span class="n">username</span><span class="p">))</span>

		<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_all_graphs_for_user"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_all_graphs_for_user">[docs]</a><span class="k">def</span> <span class="nf">get_all_graphs_for_user</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets all graphs for username</span>

<span class="sd">		:param username: Email of user in GraphSpace</span>
<span class="sd">		:return Graphs: [graphs]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Query for all graphs by a specific user</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select graph_id from graph where user_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">))</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="c"># If there are graphs for the user, return them </span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">graphs</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
				<span class="n">cleaned_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">graphs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">cleaned_data</span>

		<span class="k">return</span> <span class="p">[]</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_all_groups_in_server"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_all_groups_in_server">[docs]</a><span class="k">def</span> <span class="nf">get_all_groups_in_server</span><span class="p">():</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets all groups that are in the server</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Group is written this way because SQLITE wouldn&#39;t accept it simply as group</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select * from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="p">);</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="k">print</span> <span class="n">data</span>

		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

		<span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="c"># Return information about the group</span>
		<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
			<span class="n">cleaned_record</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">cleaned_record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
			<span class="n">cleaned_record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">cleaned_record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
			<span class="n">cleaned_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cleaned_record</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">cleaned_data</span>
	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_groups_of_user"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_groups_of_user">[docs]</a><span class="k">def</span> <span class="nf">get_groups_of_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get all groups that the user owns</span>

<span class="sd">		:param user_id: Email of user of GraphSpace</span>
<span class="sd">		:return Groups: [group information]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Get all groups that the user owns</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select * from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> where owner_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">))</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
	
		<span class="c"># Clean up the data</span>
		<span class="k">return</span> <span class="n">get_cleaned_group_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cur</span><span class="p">)</span>
	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_cleaned_group_data"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_cleaned_group_data">[docs]</a><span class="k">def</span> <span class="nf">get_cleaned_group_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get all information about group (including number of graphs group has)</span>

<span class="sd">		:param data: Information about group</span>
<span class="sd">		:param cur: Database cursor</span>
<span class="sd">		:return Groups: [gorup information + graphs in group information]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="c"># Go through and create an index including the number of graphs that a group has </span>
	<span class="k">for</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
		<span class="n">cleaned_group</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">cleaned_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">cleaned_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_name</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
		<span class="n">cleaned_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_name</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select count(*) from group_to_graph where group_id=? and user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">group_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">group_name</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
		<span class="n">new_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="n">cleaned_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">cleaned_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_name</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
		<span class="n">cleaned_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_name</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
		<span class="n">cleaned_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">cleaned_group</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">cleaned_group</span><span class="p">)</span>

		<span class="n">cleaned_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cleaned_group</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">cleaned_data</span>
</div>
<div class="viewcode-block" id="get_all_groups_with_member"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_all_groups_with_member">[docs]</a><span class="k">def</span> <span class="nf">get_all_groups_with_member</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get all groups that has the user as a member in that group.</span>

<span class="sd">		:param user_id: Member to be searched for in all groups</span>
<span class="sd">		:return Groups: [Groups that user_id is a member of]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Get all groups that user is a member of</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select group_id from group_to_user where user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">))</span>

		<span class="n">group_names</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="c"># Get information about those groups</span>
		<span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">group_names</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select * from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> where group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">group_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">))</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
			<span class="n">cleaned_data</span> <span class="o">+=</span> <span class="n">get_cleaned_group_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cur</span><span class="p">)</span>

		<span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cleaned_data</span><span class="p">))</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_group_by_id"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_group_by_id">[docs]</a><span class="k">def</span> <span class="nf">get_group_by_id</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets a group information by group id ( REST API option).</span>
<span class="sd">	</span>
<span class="sd">		:param group: ID of group to be searched for</span>
<span class="sd">		:return Group: [Information about group (see REST API in Help section)]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="c"># Get information about group</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select description, owner_id, name, group_id from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> where group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="p">));</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="c"># Get members of the group </span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
			<span class="n">members</span> <span class="o">=</span> <span class="n">get_group_members</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
			<span class="n">tuple_list</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">members</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
			<span class="n">cleaned_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_list</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">cleaned_data</span>
	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_group"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_group">[docs]</a><span class="k">def</span> <span class="nf">get_group</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets all information about a certain group (used for groups page exclusively).</span>

<span class="sd">		:param group: ID of group</span>
<span class="sd">		:return Group: [information of group]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select description, owner_id, name, group_id from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> where group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="p">));</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="c"># Get group members and graphs in group etc</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
			<span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;users&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_group_members</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
			<span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;owner&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;group_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
			<span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select graph_id from group_to_graph where group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="p">))</span>
			<span class="n">graph_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
			<span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;graphs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

		<span class="k">return</span> <span class="n">cleaned_data</span>
	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="get_group_members"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_group_members">[docs]</a><span class="k">def</span> <span class="nf">get_group_members</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get all members of a group.</span>

<span class="sd">		:param group: Group ID</span>
<span class="sd">		:return Members: [Members of group]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select user_id from group_to_user where group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="p">));</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="c"># Get all members and clean up the data</span>
		<span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
			<span class="n">cleaned_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

		<span class="k">return</span> <span class="n">cleaned_data</span>
	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="can_see_shared_graph"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.can_see_shared_graph">[docs]</a><span class="k">def</span> <span class="nf">can_see_shared_graph</span><span class="p">(</span><span class="n">logged_in_user</span><span class="p">,</span> <span class="n">graph_owner</span><span class="p">,</span> <span class="n">graphname</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		See if user is allowed to see a graph.</span>

<span class="sd">		:param logged_in_user: User that is currently logged in</span>
<span class="sd">		:param graph_owner: Owner of graph being viewed</span>
<span class="sd">		:param graphname: Name of graph being viewed</span>
<span class="sd">		:return boolean: True if can see it, false otherwise</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">groups</span> <span class="o">=</span> <span class="n">get_all_groups_for_this_graph</span><span class="p">(</span><span class="n">graph_owner</span><span class="p">,</span> <span class="n">graphname</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
	        <span class="n">members</span> <span class="o">=</span> <span class="n">get_group_members</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
	        <span class="k">if</span> <span class="n">logged_in_user</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
	            <span class="k">return</span> <span class="bp">True</span>

	<span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="remove_group"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.remove_group">[docs]</a><span class="k">def</span> <span class="nf">remove_group</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Removes a group from server.</span>

<span class="sd">		:param owner: Owner of group</span>
<span class="sd">		:param group: Group ID</span>
<span class="sd">		:return &lt;result</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># If there is a group with this owner, then remove it from the server</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select owner_id from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> where owner_id=? and group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="p">));</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&quot;Group not found!&quot;</span>

		<span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&quot;Can&#39;t remove group&quot;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c"># Remove metadata from tables</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;delete from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> where owner_id=? and group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="p">))</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;delete from group_to_user where group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="p">))</span>
			<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">();</span>
			<span class="k">return</span> <span class="s">&quot;Group removed!&quot;</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="create_group"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.create_group">[docs]</a><span class="k">def</span> <span class="nf">create_group</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Inserts a uniquely named group under a username.</span>

<span class="sd">		:param owner: Owner of group</span>
<span class="sd">		:param group: Group ID</span>
<span class="sd">		:return &lt;result&gt;</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Check to see if there is a group under the username already </span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select group_id from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> where group_id=? and owner_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">username</span><span class="p">));</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

		<span class="c"># If no group exists, insert into database</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="c"># TODO: Why did I append username and groupname together?</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;insert into </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> values(?, ?, ?, ?, ?, ?)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">cleanGroupName</span><span class="p">(</span><span class="n">group</span><span class="p">),</span> <span class="n">group</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
			<span class="c"># cur.execute(&#39;insert into group_to_user values(?, ?)&#39;, (cleanGroupName(group), username))</span>
			<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
			<span class="k">return</span> <span class="n">group</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="cleanGroupName"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.cleanGroupName">[docs]</a><span class="k">def</span> <span class="nf">cleanGroupName</span><span class="p">(</span><span class="n">groupName</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Cleans group name (gets rid of spaces and _ characters)</span>

<span class="sd">		:param groupName: Name of group</span>
<span class="sd">		:return group: cleaned group name</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">groupName</span> <span class="o">=</span> <span class="n">groupName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="n">groupName</span> <span class="o">=</span> <span class="n">groupName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">groupName</span>
</div>
<div class="viewcode-block" id="groups_for_user"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.groups_for_user">[docs]</a><span class="k">def</span> <span class="nf">groups_for_user</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get all groups user belongs to or owns.</span>

<span class="sd">		:param username: Email of user</span>
<span class="sd">		:return Groups: [groups]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c">#TODO: add what a user can see as well (ie has access to)</span>
		<span class="c"># Get groups that the user is a member of</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select group_id from group_to_user where user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">))</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="n">cleaned_data</span><span class="o">=</span><span class="p">[]</span>
		<span class="k">for</span> <span class="n">groups</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
			<span class="n">groups</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">cleaned_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>

		<span class="c"># Get all the groups that the user owns as well</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select group_id from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> where owner_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">))</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="k">for</span> <span class="n">groups</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
			<span class="n">groups</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">cleaned_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>

		<span class="n">cleaned_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cleaned_data</span><span class="p">))</span>

		<span class="k">return</span> <span class="n">cleaned_data</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="add_user_to_group"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.add_user_to_group">[docs]</a><span class="k">def</span> <span class="nf">add_user_to_group</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Adds a user to a group.</span>

<span class="sd">		:param username: Username to add to group</span>
<span class="sd">		:param owner: Owner of the group</span>
<span class="sd">		:param group: Group ID</span>
<span class="sd">		:return &lt;Status&gt;</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select user_id from user where user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">))</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&quot;User does not exist!&quot;</span>

		<span class="c"># If user exists and the owner of the group is issuing the request, then add the user to the group</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select group_id from group_to_user where user_id=? and group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="p">))</span>
		<span class="n">isMember</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select owner_id from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> where owner_id=? and group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">group</span><span class="p">))</span>
		<span class="n">isOwner</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">isMember</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">isOwner</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;insert into group_to_user values(?, ?)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">username</span><span class="p">))</span>
			<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">();</span>
			<span class="k">return</span> <span class="s">&quot;User added!&quot;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&quot;Become the owner/member of this group first!&quot;</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="remove_user_from_group"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.remove_user_from_group">[docs]</a><span class="k">def</span> <span class="nf">remove_user_from_group</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Removes user from group.</span>

<span class="sd">		:param username: User to remove</span>
<span class="sd">		:param owner: Owner of group</span>
<span class="sd">		:param group: Group ID</span>
<span class="sd">		:return &lt;status&gt;</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select user_id from user where user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">))</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>


		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&quot;User does not exist!&quot;</span>

		<span class="c"># If user exists and they are owner of the group, delete the requested username from the group</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select owner_id from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> where owner_id=? and group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="p">))</span>
		<span class="n">isOwner</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">isOwner</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">isOwner</span> <span class="o">=</span> <span class="n">isOwner</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;delete from group_to_user where user_id=? and group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="p">))</span>
			<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">();</span>
			<span class="k">return</span> <span class="s">&quot;User removed!&quot;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&quot;Can&#39;t delete user from a group you are not the owner of!&quot;</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="share_graph_with_group"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.share_graph_with_group">[docs]</a><span class="k">def</span> <span class="nf">share_graph_with_group</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Shares a graph with group.</span>
<span class="sd">		</span>
<span class="sd">		:param owner: Owner of group</span>
<span class="sd">		:param graph: Graph to share </span>
<span class="sd">		:param group: Group ID</span>
<span class="sd">		:return &lt;status&gt;</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Get graph information ** MUST ALREADY EXIST IN GRAPHSPACE **</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select * from graph where user_id=? and graph_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">graph</span><span class="p">))</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&#39;Graph does not exist&#39;</span>

		<span class="n">isOwner</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

		<span class="c"># If there is a graph for the owner, then we add that graph to the group that a user is a part of (user or member)</span>
		<span class="k">if</span> <span class="n">isOwner</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select user_id from group_to_user where user_id=? and group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="p">))</span>
			<span class="n">isMember</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select owner_id from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> where owner_id = ? and group_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">group</span><span class="p">))</span>
			<span class="n">isOwner</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
			<span class="c"># If the query returns, it means that the owner is a member of that group</span>
			<span class="k">if</span> <span class="n">isMember</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">isOwner</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
				<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;insert into group_to_graph values(?, ?, ?)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">graph</span><span class="p">))</span>
				<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
				<span class="k">return</span> <span class="s">&quot;Graph successfully shared!&quot;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="s">&quot;You are not a member of this group!&quot;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&quot;You don&#39;t own this graph!&quot;</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="unshare_graph_with_group"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.unshare_graph_with_group">[docs]</a><span class="k">def</span> <span class="nf">unshare_graph_with_group</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Graph to unshare with group.</span>

<span class="sd">		:param owner: Owner of group</span>
<span class="sd">		:param graph: Graph to unshare </span>
<span class="sd">		:param group: Group ID</span>
<span class="sd">		:return &lt;status&gt;</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Get the graph that the user supposedly owns</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select user_id from graph where user_id=? and graph_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="p">))</span>
		<span class="n">graph_owner</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select user_id from group_to_graph where graph_id=? and user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">owner</span><span class="p">))</span>
		<span class="n">graph_in_group</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">graph_owner</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">graph_in_group</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">graph_owner</span> <span class="o">=</span> <span class="n">graph_owner</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select user_id from group_to_user where user_id=? and group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="p">))</span>
			<span class="n">isMember</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select owner_id from </span><span class="se">\&quot;</span><span class="s">group</span><span class="se">\&quot;</span><span class="s"> where owner_id = ? and group_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">group</span><span class="p">))</span>
			<span class="n">isOwner</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
			<span class="c"># If the user has the rights to the graph/group, then carry out the unsharing of that graph from the group</span>
			<span class="k">if</span> <span class="n">isMember</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">isOwner</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
				<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;delete from group_to_graph where group_id=? and graph_id=? and user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">owner</span><span class="p">))</span>
				<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
				<span class="k">return</span> <span class="s">&quot;Graph successfully unshared!&quot;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="s">&quot;You are not a member of this group!&quot;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&quot;You don&#39;t own this graph or graph isn&#39;t shared with the group yet!&quot;</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="c"># ---------------- END REST API ------------------------------</span>
</div>
<div class="viewcode-block" id="view_graphs_of_type"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.view_graphs_of_type">[docs]</a><span class="k">def</span> <span class="nf">view_graphs_of_type</span><span class="p">(</span><span class="n">view_type</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		View graphs of this type.</span>

<span class="sd">		:param view_type: Type of view (shared, public)</span>
<span class="sd">		:param username: Name of user</span>
<span class="sd">		:return Graphs: [graphs]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">graphs</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;public&#39;</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct g.graph_id, g.modified, g.user_id, g.public from graph as g where g.public = 1&#39;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;shared&#39;</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct g.graph_id, g.modified, g.user_id, g.public from graph as g, group_to_graph as gg where gg.graph_id = g.graph_id and gg.user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct g.graph_id, g.modified, g.user_id, g.public from graph as g where g.user_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">))</span>

		<span class="n">initial_graphs</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">initial_graphs</span><span class="p">:</span>
			<span class="n">temp_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
			<span class="n">temp_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">get_all_tags_for_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">graph</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
			<span class="n">graphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">temp_list</span><span class="p">))</span>
		
		<span class="k">return</span> <span class="n">graphs</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="p">[]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_graphs_for_tags"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_graphs_for_tags">[docs]</a><span class="k">def</span> <span class="nf">get_graphs_for_tags</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns graphs that match the tags.</span>

<span class="sd">		:param cur: Database cursor</span>
<span class="sd">		:param username: Name of User</span>
<span class="sd">		:param tags: tags to match graphs to</span>
<span class="sd">		:return Graphs: [graphs]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">graphs</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">all_tag_graphs</span> <span class="o">=</span> <span class="n">get_all_graphs_for_tags</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_tag_graphs</span><span class="p">:</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct g.graph_id, g.modified, g.user_id, g.public from group_to_user as gu, graph as g, graph_to_tag as gt, group_to_graph as gg where gg.group_id = gu.group_id and gt.graph_id=g.graph_id and gg.graph_id=g.graph_id and gt.tag_id = ? and gu.user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">username</span><span class="p">))</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">thing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">all_tag_graphs</span> <span class="ow">and</span> <span class="n">thing</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">:</span>
					<span class="n">graphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">graphs</span>
</div>
<div class="viewcode-block" id="build_graph_information"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.build_graph_information">[docs]</a><span class="k">def</span> <span class="nf">build_graph_information</span><span class="p">(</span><span class="n">graphs</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets all information (including all tags) for each graph that is returned.</span>
<span class="sd">		</span>
<span class="sd">		:param graphs: Graphs to get information for</span>
<span class="sd">		:return Graphs: [graph information]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">cleaned_graph</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">:</span>
		<span class="c">#Get all tags for graph</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select tag_id from graph_to_tag where graph_id=? and user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">graph</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">graph</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
		<span class="n">tags</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="n">cleanedtags</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
			<span class="n">cleanedtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

		<span class="n">graph_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanedtags</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="c"># Insert at second location</span>
			<span class="n">graph_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cleanedtags</span><span class="p">)</span>
			<span class="n">cleaned_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">graph_list</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">graph_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
			<span class="n">cleaned_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">graph_list</span><span class="p">))</span>

	<span class="k">if</span> <span class="n">cleaned_graph</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">cleaned_graph</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="get_graph_info"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_graph_info">[docs]</a><span class="k">def</span> <span class="nf">get_graph_info</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets graph information about a graph that the user owns having certain tags.</span>

<span class="sd">		:param username: Email of user</span>
<span class="sd">		:param tags: Tags of graph to filter</span>
<span class="sd">		:return Graph: [graph information]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">graphs</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">tags</span><span class="p">:</span>
			<span class="n">all_tag_graphs</span> <span class="o">=</span> <span class="n">get_all_graphs_for_tags</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_tag_graphs</span><span class="p">:</span>
				<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct g.graph_id, g.modified, g.user_id, g.public from graph as g, graph_to_tag as gt where g.graph_id=gt.graph_id and g.user_id=? and gt.graph_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">thing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">all_tag_graphs</span> <span class="ow">and</span> <span class="n">thing</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">:</span>
							<span class="n">graphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct g.graph_id, g.modified, g.user_id, g.public from graph as g where g.user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">))</span>
			<span class="n">graphs</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">graphs</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>
		
		<span class="n">cleaned_graph</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select tag_id from graph_to_tag where graph_id=? and user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">graph</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">graph</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
			<span class="n">tags</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
			<span class="n">cleanedtags</span> <span class="o">=</span> <span class="p">[]</span>

			<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
				<span class="n">cleanedtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

			<span class="n">graph_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanedtags</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">graph_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cleanedtags</span><span class="p">)</span>
				<span class="n">cleaned_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">graph_list</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">graph_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
				<span class="n">cleaned_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">graph_list</span><span class="p">))</span>

		<span class="k">if</span> <span class="n">cleaned_graph</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">cleaned_graph</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_public_graph_info"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_public_graph_info">[docs]</a><span class="k">def</span> <span class="nf">get_public_graph_info</span><span class="p">(</span><span class="n">tags</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get all public graphs that contain the following tags.</span>

<span class="sd">		:param tags: Tags to match the graphs to</span>
<span class="sd">		:return Graphs: [graphs with tags]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="n">graphs</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">tags</span><span class="p">:</span>
			<span class="n">all_tag_graphs</span> <span class="o">=</span> <span class="n">get_all_graphs_for_tags</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

			<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_tag_graphs</span><span class="p">:</span>
				<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct g.graph_id, g.modified, g.user_id, g.public from graph as g where g.public = ? and g.graph_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">thing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">all_tag_graphs</span> <span class="ow">and</span> <span class="n">thing</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">:</span>
							<span class="n">graphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct g.graph_id, g.modified, g.user_id, g.public from graph as g where g.public=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">))</span>
			<span class="n">graphs</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">graphs</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>
		
		<span class="n">cleaned_graph</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select tag_id from graph_to_tag where graph_id=? and user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">graph</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">graph</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
			<span class="n">tags</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
			<span class="n">cleanedtags</span> <span class="o">=</span> <span class="p">[]</span>

			<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
				<span class="n">cleanedtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>


			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanedtags</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="c"># for tag in tags:</span>
				<span class="n">graph_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
				<span class="n">graph_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cleanedtags</span><span class="p">)</span>
				<span class="n">cleaned_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">graph_list</span><span class="p">))</span>

		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned_graph</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">cleaned_graph</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_all_graph_info"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_all_graph_info">[docs]</a><span class="k">def</span> <span class="nf">get_all_graph_info</span><span class="p">(</span><span class="n">tags</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets all the information about a graph that user owns that matches the tags.</span>

<span class="sd">		:param tags: Tags that the user owns</span>
<span class="sd">		:return Graphs: [graphs with tags]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct g.graph_id, g.modified, g.user_id, g.public from graph as g&#39;</span><span class="p">)</span>
		<span class="n">graphs</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">graphs</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="n">cleaned_graph</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">:</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select tag_id from graph_to_tag where graph_id=? and user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">graph</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">graph</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
			<span class="n">tags</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
			<span class="n">cleanedtags</span> <span class="o">=</span> <span class="p">[]</span>

			<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
				<span class="n">cleanedtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>


			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanedtags</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="c"># for tag in tags:</span>
				<span class="n">graph_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
				<span class="n">graph_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cleanedtags</span><span class="p">)</span>
				<span class="n">cleaned_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">graph_list</span><span class="p">))</span>

		<span class="k">if</span> <span class="n">cleaned_graph</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">cleaned_graph</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="is_public_graph"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.is_public_graph">[docs]</a><span class="k">def</span> <span class="nf">is_public_graph</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Checks to see if a given graph for a user is public.</span>

<span class="sd">		:param username: Email of user</span>
<span class="sd">		:param graph: Graph of user</span>
<span class="sd">		:return boolean: True if public graph</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># If there is a graph with the username and graph, return if it is public or not</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select public from graph where user_id=? and graph_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">graph</span><span class="p">))</span>
		<span class="n">public</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">public</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

		<span class="n">public</span> <span class="o">=</span> <span class="n">public</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		
		<span class="k">if</span> <span class="n">public</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">True</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_all_groups_for_this_graph"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_all_groups_for_this_graph">[docs]</a><span class="k">def</span> <span class="nf">get_all_groups_for_this_graph</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets all the groups that the graph is shared with.</span>

<span class="sd">		:param uid: User of the graph</span>
<span class="sd">		:param graph: Name of graph</span>
<span class="sd">		:return Groups: [groups]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select group_id from group_to_graph where graph_id=? and user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">uid</span><span class="p">))</span>
		<span class="n">graphs</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">graphs</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>
		
		<span class="n">cleaned_graphs</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="n">graphs</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">:</span>
				<span class="n">cleaned_graphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">graph</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
			<span class="k">return</span> <span class="n">cleaned_graphs</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">Nonef</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Error </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="emailExists"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.emailExists">[docs]</a><span class="k">def</span> <span class="nf">emailExists</span><span class="p">(</span><span class="n">email</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Checks to see if a user&#39;s email exists.</span>

<span class="sd">		:param email: Email of user</span>
<span class="sd">		:return boolean: True if user exists</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select user_id from user where user_id = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">email</span><span class="p">])</span>

		<span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">data</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
   
    		<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">:&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="sendForgotEmail"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.sendForgotEmail">[docs]</a><span class="k">def</span> <span class="nf">sendForgotEmail</span><span class="p">(</span><span class="n">email</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Emails the user to reset their password.</span>

<span class="sd">		:param email of user</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">if</span> <span class="n">emailExists</span><span class="p">(</span><span class="n">email</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
		<span class="n">con</span><span class="o">=</span><span class="bp">None</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
			<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

			<span class="n">add_user_to_password_reset</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select code from password_reset where user_id = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">email</span><span class="p">])</span>

			<span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">None</span>

			<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
			<span class="n">mail_title</span> <span class="o">=</span> <span class="s">&#39;Password Reset Information for GraphSpace!&#39;</span>
			<span class="n">message</span> <span class="o">=</span> <span class="s">&#39;Please go to the following url to reset your password: http://localhost:8000/reset/?id=&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">emailFrom</span> <span class="o">=</span> <span class="s">&quot;GraphSpace Admin&quot;</span>
			<span class="n">send_mail</span><span class="p">(</span><span class="n">mail_title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">emailFrom</span><span class="p">,</span> <span class="p">[</span><span class="n">email</span><span class="p">],</span> <span class="n">fail_silently</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
			<span class="k">return</span> <span class="s">&quot;Email Sent!&quot;</span>
		<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

		<span class="k">finally</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
				<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="retrieveResetInfo"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.retrieveResetInfo">[docs]</a><span class="k">def</span> <span class="nf">retrieveResetInfo</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Retrieves the reset information for a user (for comparing which user it is).</span>

<span class="sd">		:param code: Code that the user has to match to HTTP GET request</span>
<span class="sd">		:return account: Account associated with the code </span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span><span class="o">=</span><span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select user_id from password_reset where code = ?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="p">))</span>

		<span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>


		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

		<span class="n">accountToReset</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">accountToReset</span>
	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="resetPassword"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.resetPassword">[docs]</a><span class="k">def</span> <span class="nf">resetPassword</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Updates password information about a user.</span>

<span class="sd">		:param username: Email of user</span>
<span class="sd">		:param password: Password of user</span>

<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span><span class="o">=</span><span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;update user set password = ? where user_id = ?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">bcrypt</span><span class="o">.</span><span class="n">hashpw</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">gensalt</span><span class="p">()),</span> <span class="n">username</span><span class="p">))</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;delete from password_reset where user_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">))</span>

		<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">();</span>
		<span class="k">return</span> <span class="s">&quot;Password Updated!&quot;</span>
	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># Changes the name of a layout</span></div>
<div class="viewcode-block" id="changeLayoutName"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.changeLayoutName">[docs]</a><span class="k">def</span> <span class="nf">changeLayoutName</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">old_layout_name</span><span class="p">,</span> <span class="n">new_layout_name</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Changes the name of the layout.</span>

<span class="sd">		:param uid: Owner of graph</span>
<span class="sd">		:param gid: Name of graph</span>
<span class="sd">		:param old_layout_name: Old name of layout</span>
<span class="sd">		:param new_layout_name: New name of layout</span>
<span class="sd">		:param loggedIn: User making those changes</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span><span class="o">=</span><span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;update layout set layout_name = ? where owner_id=? and graph_id = ? and user_id=? and layout_name = ? &#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">new_layout_name</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">,</span> <span class="n">old_layout_name</span><span class="p">))</span>
		<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># Makes a layout public</span></div>
<div class="viewcode-block" id="makeLayoutPublic"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.makeLayoutPublic">[docs]</a><span class="k">def</span> <span class="nf">makeLayoutPublic</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">public_layout</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Makes a layout public.</span>

<span class="sd">		:param uid: Owner of graph</span>
<span class="sd">		:param gid: Name of graph</span>
<span class="sd">		:param public_layout: Name of layout</span>
<span class="sd">		:param loggedIn: Use rmaking those changes</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span><span class="o">=</span><span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;update layout set public = 1 where owner_id=? and graph_id = ? and user_id=? and layout_name = ? &#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">,</span> <span class="n">public_layout</span><span class="p">))</span>
		<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c"># Saves layout of a specified graph</span></div>
<div class="viewcode-block" id="save_layout"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.save_layout">[docs]</a><span class="k">def</span> <span class="nf">save_layout</span><span class="p">(</span><span class="n">layout_id</span><span class="p">,</span> <span class="n">layout_name</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">public</span><span class="p">,</span> <span class="n">unlisted</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Saves layout of specific graph.</span>

<span class="sd">		:param layout_id: Id of layout to save</span>
<span class="sd">		:param layout_name: Name of layout to save</span>
<span class="sd">		:param owner: Owner of the graph</span>
<span class="sd">		:param graph: Name of the graph</span>
<span class="sd">		:param user: user making those changes</span>
<span class="sd">		:param json: JSON of the graph</span>
<span class="sd">		:param public: Is layout public or not</span>
<span class="sd">		:param unlisted: Possible deprecated</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span><span class="o">=</span><span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>	

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;insert into layout values(?,?,?,?,?,?,?,?)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">layout_name</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
		<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
		<span class="k">return</span> <span class="s">&quot;Layout Saved!&quot;</span>
	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="deleteLayout"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.deleteLayout">[docs]</a><span class="k">def</span> <span class="nf">deleteLayout</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">layoutToDelete</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Deletes layout from graph.</span>

<span class="sd">		:param uid: Owner of graph</span>
<span class="sd">		:param gid: Name of graph</span>
<span class="sd">		:param layoutToDelete: name of layout to delete</span>
<span class="sd">		:param loggedIn: User that is deleting the graph</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span><span class="o">=</span><span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;delete from layout where layout_name = ? and owner_id = ? and graph_id = ? and user_id = ?&#39;</span> <span class="p">,</span> <span class="p">(</span><span class="n">layoutToDelete</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">))</span>
		<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="get_layout_for_graph"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_layout_for_graph">[docs]</a><span class="k">def</span> <span class="nf">get_layout_for_graph</span><span class="p">(</span><span class="n">layout_name</span><span class="p">,</span> <span class="n">layout_graph</span><span class="p">,</span> <span class="n">layout_owner</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Retrieves specific layout for a certain graph.</span>

<span class="sd">		:param layout_name: Name of layout</span>
<span class="sd">		:param layout_graph: Name of graph</span>
<span class="sd">		:param layout_owner: Owner of layout</span>
<span class="sd">		:return Layout: [layout]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span><span class="o">=</span><span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Get JSON of layout</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select json from layout where layout_name =? and graph_id=? and owner_id=?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">layout_name</span><span class="p">,</span> <span class="n">layout_graph</span><span class="p">,</span> <span class="n">layout_owner</span><span class="p">))</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

		<span class="k">print</span> <span class="n">data</span>

		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

		<span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_all_layouts_for_graph"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_all_layouts_for_graph">[docs]</a><span class="k">def</span> <span class="nf">get_all_layouts_for_graph</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get all layouts for graph.</span>

<span class="sd">		:param uid: Owner of graph</span>
<span class="sd">		:param gid: Name of graph</span>
<span class="sd">		:return Layouts: [layouts of graph]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span><span class="o">=</span><span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select layout_name from layout where owner_id =? and graph_id=?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">))</span>
		
		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

		<span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">graphs</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
			<span class="n">graphs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">graphs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="c"># Replace for URL</span>
			<span class="n">graphs</span> <span class="o">=</span> <span class="n">graphs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;%20&quot;</span><span class="p">)</span>
			<span class="n">cleaned_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graphs</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">cleaned_data</span>
	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># Gets my layouts for a graph</span></div>
<div class="viewcode-block" id="get_my_layouts_for_graph"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_my_layouts_for_graph">[docs]</a><span class="k">def</span> <span class="nf">get_my_layouts_for_graph</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get my layouts for this graph.</span>

<span class="sd">		:param uid: Owner of graph</span>
<span class="sd">		:param gid: Name of graph</span>
<span class="sd">		:param loggedIn: Current user of graphspace</span>
<span class="sd">		:return Layouts: [my layouts of graph]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span><span class="o">=</span><span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="c"># Get my layouts</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select layout_name from layout where owner_id =? and graph_id=? and user_id=?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">))</span>
		
		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

		<span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">graphs</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
			<span class="n">graphs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">graphs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="c"># Replace for URL</span>
			<span class="n">graphs</span> <span class="o">=</span> <span class="n">graphs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;%20&quot;</span><span class="p">)</span>
			<span class="n">cleaned_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graphs</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">cleaned_data</span>
	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_shared_layouts_for_graph"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_shared_layouts_for_graph">[docs]</a><span class="k">def</span> <span class="nf">get_shared_layouts_for_graph</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get shared layouts for this graph.</span>

<span class="sd">		:param uid: Owner of graph</span>
<span class="sd">		:param gid: Name of graph</span>
<span class="sd">		:param loggedIn: Current user of graphspace</span>
<span class="sd">		:return Layouts: [shared layouts of graph]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="c"># Get all shared groups for this graph</span>
	<span class="n">all_groups_for_graph</span> <span class="o">=</span> <span class="n">get_all_groups_for_this_graph</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">)</span>
	<span class="n">shared_graphs</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="c"># Get all members of the shared groups</span>
	<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">all_groups_for_graph</span><span class="p">:</span>
		<span class="n">members</span> <span class="o">=</span> <span class="n">get_group_members</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">loggedIn</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
				<span class="n">shared_graphs</span> <span class="o">+=</span> <span class="n">get_my_layouts_for_graph</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">shared_graphs</span>
</div>
<div class="viewcode-block" id="get_public_layouts_for_graph"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_public_layouts_for_graph">[docs]</a><span class="k">def</span> <span class="nf">get_public_layouts_for_graph</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get public layouts for this graph.</span>

<span class="sd">		:param uid: Owner of graph</span>
<span class="sd">		:param gid: Name of graph</span>
<span class="sd">		:return Layouts: [public layouts of graph]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span><span class="o">=</span><span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>

		<span class="c"># Get public layouts</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select layout_name from layout where owner_id =? and graph_id=? and public=1&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">))</span>
		
		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>

		<span class="c"># Replace any spaces with html equivalent</span>
		<span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">graphs</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
			<span class="n">graphs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">graphs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="c"># Replace for URL</span>
			<span class="n">graphs</span> <span class="o">=</span> <span class="n">graphs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;%20&quot;</span><span class="p">)</span>
			<span class="n">cleaned_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graphs</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">cleaned_data</span>
	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_all_graphs_for_tags"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_all_graphs_for_tags">[docs]</a><span class="k">def</span> <span class="nf">get_all_graphs_for_tags</span><span class="p">(</span><span class="n">tags</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get all graphs that match the tags.</span>

<span class="sd">		:param tags: [List of tags to match]</span>
<span class="sd">		:return Graphs: [graphs that contain these tags]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="c"># Split tags into a list</span>
	<span class="k">if</span> <span class="n">tags</span><span class="p">:</span>
		<span class="n">tag_terms</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tag_terms</span><span class="p">)):</span>
			<span class="n">tag_terms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag_terms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

		<span class="n">con</span><span class="o">=</span><span class="bp">None</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
			<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

			<span class="n">graphs_for_tag_list</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">actual_graphs_for_tags</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="c"># Search for graphs for each tag term and append them to list</span>
			<span class="k">for</span> <span class="n">tag_id</span> <span class="ow">in</span> <span class="n">tag_terms</span><span class="p">:</span>
				<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct g.graph_id from graph as g, graph_to_tag as gt where gt.tag_id=? and g.graph_id = gt.graph_id&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tag_id</span><span class="p">,</span> <span class="p">))</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
						<span class="n">graphs_for_tag_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

			<span class="c"># Get number of times the graph names appear.</span>
			<span class="c"># If they appear the same number of times as the lenght of the tag terms</span>
			<span class="c"># it implicitly means that the graph has all of the tags that are being searched for.</span>
			<span class="c"># Those graphs that pass the length check are returned as having all of the tags</span>
			<span class="n">accurate_tags</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">graphs_for_tag_list</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs_for_tag_list</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">accurate_tags</span><span class="p">[</span><span class="n">graph</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_terms</span><span class="p">):</span>
					<span class="n">actual_graphs_for_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

			<span class="k">return</span> <span class="n">actual_graphs_for_tags</span>

		<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="k">finally</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
				<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">None</span>

<span class="c"># find all tags for a user</span></div>
<div class="viewcode-block" id="get_all_tags_for_user"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_all_tags_for_user">[docs]</a><span class="k">def</span> <span class="nf">get_all_tags_for_user</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Return all tags that a user has for their graphs.</span>

<span class="sd">		:param username: Email of user in GraphSpace</span>
<span class="sd">		:return Tags: [tags]</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="c"># Get tags that the user has and return them</span>
		<span class="n">tags_list</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct tag_id from graph_to_tag where user_id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">))</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
				<span class="n">tags_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

		<span class="k">return</span> <span class="n">tags_list</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_all_tags_for_graph"><a class="viewcode-back" href="../../../Code.html#graphs.util.db.get_all_tags_for_graph">[docs]</a><span class="k">def</span> <span class="nf">get_all_tags_for_graph</span><span class="p">(</span><span class="n">graphname</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns all of the tags for a specific graph.</span>
<span class="sd">	</span>
<span class="sd">		:param graphname: Name of graph to search for</span>
<span class="sd">		:param username: Email of user in GraphSpace</span>
<span class="sd">		:return Tags: [tags of graph]</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">con</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

		<span class="n">tags_list</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="c"># Get tags for specified graph and return it</span>
		<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select distinct tag_id from graph_to_tag where user_id = ? and graph_id=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">graphname</span><span class="p">))</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
				<span class="n">tags_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

		<span class="k">return</span> <span class="n">tags_list</span>

	<span class="k">except</span> <span class="n">lite</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">return</span> <span class="bp">None</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">con</span><span class="p">:</span>
			<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
				</div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">GraphSpace Documentation 0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Divit Singh.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>