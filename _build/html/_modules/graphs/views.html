<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>graphs.views &mdash; GraphSpace Documentation 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="GraphSpace Documentation 0.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">GraphSpace Documentation 0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for graphs.views</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span><span class="p">,</span> <span class="n">EmptyPage</span><span class="p">,</span> <span class="n">PageNotAnInteger</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">,</span> <span class="n">Http404</span>
<span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">generic</span>

<span class="kn">from</span> <span class="nn">graphs.util.db_conn</span> <span class="kn">import</span> <span class="n">Database</span>
<span class="kn">from</span> <span class="nn">graphs.util.paginator</span> <span class="kn">import</span> <span class="n">pager</span>
<span class="kn">from</span> <span class="nn">graphs.util</span> <span class="kn">import</span> <span class="n">db</span>
<span class="kn">from</span> <span class="nn">graphs.auth.login</span> <span class="kn">import</span> <span class="n">login</span>
<span class="kn">from</span> <span class="nn">forms</span> <span class="kn">import</span> <span class="n">LoginForm</span><span class="p">,</span> <span class="n">SearchForm</span><span class="p">,</span> <span class="n">RegisterForm</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.orm.exc</span> <span class="kn">import</span> <span class="n">NoResultFound</span>

<span class="kn">import</span> <span class="nn">sqlalchemy</span><span class="o">,</span> <span class="nn">sqlalchemy.orm</span>
<span class="kn">import</span> <span class="nn">models</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">graphs.util.db_init</span> <span class="kn">as</span> <span class="nn">db_init</span>
<span class="kn">import</span> <span class="nn">bcrypt</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">groupby</span>
<span class="kn">from</span> <span class="nn">graphs.util.json_converter</span> <span class="kn">import</span> <span class="n">convert_json</span>

<span class="c">#get database</span>
<span class="n">data_connection</span> <span class="o">=</span> <span class="n">db_init</span><span class="o">.</span><span class="n">db</span>

<span class="c">#get tables from the database</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">db_init</span><span class="o">.</span><span class="n">graph</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">db_init</span><span class="o">.</span><span class="n">user</span>
<span class="n">group</span> <span class="o">=</span> <span class="n">db_init</span><span class="o">.</span><span class="n">group</span>
<span class="n">group_to_graph</span> <span class="o">=</span> <span class="n">db_init</span><span class="o">.</span><span class="n">group_to_graph</span>

<span class="c">##### VIEWS #####</span>
<div class="viewcode-block" id="index"><a class="viewcode-back" href="../../Code.html#graphs.views.index">[docs]</a><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Render the main page</span>

<span class="sd">        :param request: HTTP GET Request</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#####################</span>
    <span class="c"># UNCOMMENT THESE ON INITIAL START UP TO POPULATE TABLES</span>
    <span class="c">#####################</span>
    <span class="c"># db.add_everyone_to_password_reset()</span>

    <span class="c"># db.insert_all_edges_from_json()</span>
    <span class="c">#####################</span>


    <span class="c"># handle login.</span>
    <span class="c"># see graphs.auth.login for details</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">context</span><span class="p">[</span><span class="s">&#39;Error&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">[</span><span class="s">&#39;Error&#39;</span><span class="p">]}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>

    <span class="c"># If there is someone logged in, return the &#39;my graphs&#39; page, otherwise redirect to inital screen</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_graphs_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;my graphs&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/index.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="view_graph"><a class="viewcode-back" href="../../Code.html#graphs.views.view_graph">[docs]</a><span class="k">def</span> <span class="nf">view_graph</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        View a graph with CytoscapeJS.</span>

<span class="sd">        :param request: HTTP GET Request</span>
<span class="sd">        :param uid: Owner of the graph to view</span>
<span class="sd">        :param gid: Graph id of the graph to view</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#create a new db session</span>
    <span class="n">db_session</span> <span class="o">=</span> <span class="n">data_connection</span><span class="o">.</span><span class="n">new_session</span><span class="p">()</span>

    <span class="c"># context contains all the elements we want to render on the web</span>
    <span class="c"># page. we fill in the various elements of context before calling</span>
    <span class="c"># the render() function.</span>
    <span class="c">#handle login</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="c"># if the graph is public, or if a user is a member </span>
    <span class="c"># of the group where this graph is shared</span>
    <span class="c"># or if he owns this graph, then allow him to view it</span>
    <span class="c"># otherwise do not allow it</span>
    <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">is_public_graph</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">):</span>
        <span class="n">graph_to_view</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">json</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">public</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">graph_id</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="o">==</span><span class="n">uid</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">graph_id</span><span class="o">==</span><span class="n">gid</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Not Authorized to view this.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># If the user is member of group where this graph is shared</span>
        <span class="n">user_is_member</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">can_see_shared_graph</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">],</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">)</span>

        <span class="c"># if admin, then they can see everything</span>
        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">is_admin</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">uid</span> <span class="ow">or</span> <span class="n">user_is_member</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">graph_to_view</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">json</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">public</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">graph_id</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="o">==</span><span class="n">uid</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">graph_id</span><span class="o">==</span><span class="n">gid</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Not Authorized to view this!&quot;</span><span class="p">)</span>

    <span class="c"># Get correct layout for the graph to view</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">set_layout_context</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">)</span>

    <span class="c"># Convert JSON for CytoscapeJS, if needed</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">retrieve_cytoscape_json</span><span class="p">(</span><span class="n">graph_to_view</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;draw_graph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c"># Get all the groups that are shared for this graph</span>
    <span class="n">shared_groups</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_groups_for_this_graph</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">graph_to_view</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;shared_groups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shared_groups</span>

    <span class="k">if</span> <span class="n">graph_to_view</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;shared&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Publicly Shared&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;shared&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Privately Shared&#39;</span>

    <span class="c"># TODO: This will eventually get deleted</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">])</span>
    <span class="c">#add sidebar information to the context for display</span>
    <span class="k">if</span> <span class="s">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">[</span><span class="s">&#39;metadata&#39;</span><span class="p">]:</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s">&#39;metadata&#39;</span><span class="p">][</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&lt;/table&gt;&lt;/html&gt;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

    <span class="c"># id of the owner of this graph</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;owner&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uid</span>

    <span class="c"># graph id</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;graph_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gid</span>

    <span class="k">if</span> <span class="s">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;data&#39;</span><span class="p">]:</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;filters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c"># redirect if the user wishes to view the json data</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;GET&quot;</span> <span class="ow">and</span> <span class="s">&#39;view_json&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&quot;/json/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/view_graph.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="view_json"><a class="viewcode-back" href="../../Code.html#graphs.views.view_json">[docs]</a><span class="k">def</span> <span class="nf">view_json</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        View json structure of a graph.</span>

<span class="sd">        :param request: HTTP GET Request</span>
<span class="sd">        :param uid: email of the user that owns this graph</span>
<span class="sd">        :param gid: name of graph that the user owns</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#create a new db session</span>
    <span class="n">db_session</span> <span class="o">=</span> <span class="n">data_connection</span><span class="o">.</span><span class="n">new_session</span><span class="p">()</span>

    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Get the json of the graph that we want to view</span>
        <span class="n">graph_to_view</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">json</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="o">==</span><span class="n">uid</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">graph_id</span><span class="o">==</span><span class="n">gid</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">NoResultFound</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&#39;&lt;h1&gt;Graph not found&lt;/h1&gt;&#39;</span><span class="p">)</span>

    <span class="c"># Get correct json for CytoscapeJS</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">retrieve_cytoscape_json</span><span class="p">(</span><span class="n">graph_to_view</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c"># id of the owner of this graph</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;owner&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uid</span>

    <span class="c"># graph id</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;graph_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gid</span>

    <span class="c"># If it is http request, render it in the specific page, otherwise just return the JSON</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/view_json.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;json&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="graphs"><a class="viewcode-back" href="../../Code.html#graphs.views.graphs">[docs]</a><span class="k">def</span> <span class="nf">graphs</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render the My Graphs page</span>

<span class="sd">        :param request: HTTP GET Request</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">_graphs_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;my graphs&#39;</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="shared_graphs"><a class="viewcode-back" href="../../Code.html#graphs.views.shared_graphs">[docs]</a><span class="k">def</span> <span class="nf">shared_graphs</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render the graphs/shared/ page showing all graphs that are shared with a user</span>

<span class="sd">        :param request: HTTP GET Request</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">return</span> <span class="n">_graphs_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;shared&#39;</span><span class="p">)</span> 
</div>
<div class="viewcode-block" id="public_graphs"><a class="viewcode-back" href="../../Code.html#graphs.views.public_graphs">[docs]</a><span class="k">def</span> <span class="nf">public_graphs</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render the graphs/public/ page showing all graphs that are public</span>

<span class="sd">        :param request: HTTP GET Request</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">_graphs_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;public&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="all_graphs"><a class="viewcode-back" href="../../Code.html#graphs.views.all_graphs">[docs]</a><span class="k">def</span> <span class="nf">all_graphs</span><span class="p">(</span>
    <span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render the graphs/all/ page showing all graphs. Admin feature [NOT CURRENTLY SUPPORTED]</span>

<span class="sd">        :param request: HTTP GET Request</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">_graphs_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;all&#39;</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">_graphs_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">view_type</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        wrapper view for the following pages:</span>
<span class="sd">            graphs/</span>
<span class="sd">            graphs/shared/</span>
<span class="sd">            graphs/public/</span>
<span class="sd">            graphs/all/</span>

<span class="sd">        :param request: HTTP GET Request</span>
<span class="sd">        :param view_type: Type of view for graph (Ex: my graphs, shared, public)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c">#get new session from the database</span>
    <span class="n">db_session</span> <span class="o">=</span> <span class="n">data_connection</span><span class="o">.</span><span class="n">new_session</span><span class="p">()</span>
    
    <span class="c">#context of the view to be passed in for rendering</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">graph_list</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">#handle login</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">context</span><span class="p">[</span><span class="s">&#39;Error&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;Error&#39;</span><span class="p">])</span>

    <span class="c">#check for authentication</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">]</span>

    <span class="c"># pass the tag information to the front-end</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;all_tags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_tags</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">view_type</span><span class="p">)</span>

    <span class="c"># Set the base URL&#39;s so that the links point to the correct view types</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;base_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_base_urls</span><span class="p">(</span><span class="n">view_type</span><span class="p">)</span>

    <span class="c"># Set all information abouut graphs to the front-end</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_graphs_for_view_type</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">view_type</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;search&#39;</span><span class="p">),</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;tags&#39;</span><span class="p">))</span>

    <span class="c"># reset the search form</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;search_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SearchForm</span><span class="p">(</span><span class="n">placeholder</span><span class="o">=</span><span class="s">&#39;Search...&#39;</span><span class="p">)</span>

    <span class="c">#Divide the results of the query into pages. Currently has poor performance</span>
    <span class="c">#because the page processes a query (which may take long)</span>
    <span class="c">#everytime the page loads. I think that this can be improved if</span>
    <span class="c">#I store the query result in the session such that it doesn&#39;t</span>
    <span class="c">#process the query unnecessarily.</span>
    <span class="k">if</span> <span class="n">context</span><span class="p">[</span><span class="s">&#39;graph_list&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">pager_context</span> <span class="o">=</span> <span class="n">pager</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">[</span><span class="s">&#39;graph_list&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pager_context</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pager_context</span><span class="p">)</span>

    <span class="c"># indicator to include css/js footer for side menu support etc.</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;footer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/graphs.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<div class="viewcode-block" id="groups"><a class="viewcode-back" href="../../Code.html#graphs.views.groups">[docs]</a><span class="k">def</span> <span class="nf">groups</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Render the Owner Of page, showing groups that are owned by the user. </span>

<span class="sd">        :param request: HTTP GET Request</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_groups_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;owner of&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="groups_member"><a class="viewcode-back" href="../../Code.html#graphs.views.groups_member">[docs]</a><span class="k">def</span> <span class="nf">groups_member</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render the Member Of page, showing the groups that the user belong to .</span>

<span class="sd">        :param request: HTTP GET Request</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_groups_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;member&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="all_groups"><a class="viewcode-back" href="../../Code.html#graphs.views.all_groups">[docs]</a><span class="k">def</span> <span class="nf">all_groups</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Render the All Groups page, showing all groups in the database.Admin feature [NOT CURRENTLY SUPPORTED].</span>

<span class="sd">        :param request: HTTP GET Request</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_groups_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;all&#39;</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">_groups_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">view_type</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wrapper view for the following pages:</span>
<span class="sd">            groups/</span>
<span class="sd">            groups/member/</span>
<span class="sd">            groups/public/</span>
<span class="sd">            groups/all/</span>

<span class="sd">        :param request: HTTP GET Request</span>
<span class="sd">        :param view_type: Type of view for the group (Example: My Groups, member, public, all)</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#get new session from the database</span>
    <span class="n">db_session</span> <span class="o">=</span> <span class="n">data_connection</span><span class="o">.</span><span class="n">new_session</span><span class="p">()</span>
    
    <span class="c">#context of the view to be passed in for rendering</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">group_list</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">#handle login</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="c">#check for authentication</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">uid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c"># Get groups that the user is a member of</span>
        <span class="k">if</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;member&#39;</span><span class="p">:</span>
            <span class="n">group_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_groups_with_member</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">])</span>

        <span class="c"># if admin, then they can view this</span>
        <span class="k">elif</span> <span class="n">view_type</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">is_admin</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">group_list</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">group_id</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
                        <span class="n">group</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">owner_id</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">public</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Not Authorized to see this page!&quot;</span><span class="p">)</span>

        <span class="c">#groups of logged in user(my groups)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># List all groups that uid either owns or is a member of and also public groups.</span>
            <span class="n">group_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_groups_of_user</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">])</span>

        <span class="c">#add the group list to context to display on the page.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;group_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;group_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">pager_context</span> <span class="o">=</span> <span class="n">pager</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">group_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pager_context</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pager_context</span><span class="p">)</span>

        <span class="n">context</span><span class="p">[</span><span class="s">&#39;my_groups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">get_groups_of_user</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">]))</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;member_groups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">get_all_groups_with_member</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/groups.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="c">#No public groups anymore</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Need to log in to access this page!&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="graphs_in_group"><a class="viewcode-back" href="../../Code.html#graphs.views.graphs_in_group">[docs]</a><span class="k">def</span> <span class="nf">graphs_in_group</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">group_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Groups/group_name page, where group_name is the name of the</span>
<span class="sd">        group to view the graphs that belong to the group.</span>

<span class="sd">        This is the view displayed when the user clicks a group listed</span>
<span class="sd">        on the /groups page.</span>

<span class="sd">        Group names that are not allowed: &#39;all&#39;, &#39;member&#39; and &#39;public&#39;.</span>
<span class="sd">        they are preoccupied.</span>

<span class="sd">        :param request: HTTP GET Request</span>
<span class="sd">        :param group_id: Name of group to get</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#handle login</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="c">#create a new db session</span>
    <span class="n">db_session</span> <span class="o">=</span> <span class="n">data_connection</span><span class="o">.</span><span class="n">new_session</span><span class="p">()</span>

    <span class="c"># add search form</span>
    <span class="n">search_form</span> <span class="o">=</span> <span class="n">SearchForm</span><span class="p">()</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;search_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_form</span>

    <span class="c"># if the group name is not one of the designated names, display graphs</span>
    <span class="c"># that belong to the group</span>
    <span class="k">if</span> <span class="n">group_id</span> <span class="o">!=</span> <span class="s">&#39;all&#39;</span> <span class="ow">or</span> <span class="n">group_id</span> <span class="o">!=</span> <span class="s">&#39;member&#39;</span><span class="p">:</span>

        <span class="n">group_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">groups_for_user</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">group_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">group_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Not allowed to see this!&quot;</span><span class="p">)</span>

        <span class="c"># query for graphs that belong to this group</span>
        <span class="n">graphs_of_this_group</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">group_to_graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> 
                                        <span class="n">group_to_graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">graph_id</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                                                    <span class="n">group_to_graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">group_id</span><span class="o">==</span><span class="n">group_id</span>
                                                    <span class="p">)</span><span class="o">.</span><span class="n">subquery</span><span class="p">()</span>

        <span class="c"># query the graph table for specific information of each and every graph</span>
        <span class="c"># that belong to the group</span>
        <span class="n">graph_data</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">graph_id</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> 
                                      <span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">public</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                                            <span class="n">graph</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">graph_id</span><span class="o">==</span><span class="n">graphs_of_this_group</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">graph_id</span>
                                            <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


        <span class="c"># include the graph data to the context</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph_data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;graph_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;graph_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">group_information</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_group_by_id</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>

        <span class="c"># pass the group_id to the context for display</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;group_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_information</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>

        <span class="n">context</span><span class="p">[</span><span class="s">&#39;group_owner&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_information</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">context</span><span class="p">[</span><span class="s">&#39;group_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_information</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">context</span><span class="p">[</span><span class="s">&#39;group_members&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_information</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="c">#Divide the results of the query into pages. Currently has poor performance</span>
        <span class="c">#because the page processes a query (which may take long)</span>
        <span class="c">#everytime the page loads. I think that this can be improved if</span>
        <span class="c">#I store the query result in the session such that it doesn&#39;t</span>
        <span class="c">#process the query unnecessarily.</span>
        <span class="n">pager_context</span> <span class="o">=</span> <span class="n">pager</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">graph_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pager_context</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pager_context</span><span class="p">)</span>

        <span class="c"># indicator to include css/js footer for side menu support etc.</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;footer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/graphs_in_group.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="c"># if the group name is one of the designated names, display</span>
    <span class="c"># appropriate vies for each</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">group_id</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">all_groups</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">group_id</span> <span class="o">==</span> <span class="s">&#39;member&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">groups_member</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">public_groups</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="help"><a class="viewcode-back" href="../../Code.html#graphs.views.help">[docs]</a><span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render the following pages:</span>

<span class="sd">        help/</span>
<span class="sd">        help/getting_started</span>

<span class="sd">        :param request: HTTP GET Request</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#handle login</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/help_getting_started.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="help_tutorials"><a class="viewcode-back" href="../../Code.html#graphs.views.help_tutorials">[docs]</a><span class="k">def</span> <span class="nf">help_tutorials</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render the help/tutorials page.</span>

<span class="sd">        :param request: HTTP GET Request</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#handle login</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/help_tutorials.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="help_graphs"><a class="viewcode-back" href="../../Code.html#graphs.views.help_graphs">[docs]</a><span class="k">def</span> <span class="nf">help_graphs</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render the help/graphs page.</span>

<span class="sd">        :param request: HTTP GET Request</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#handle login</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/help_graphs.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="help_restapi"><a class="viewcode-back" href="../../Code.html#graphs.views.help_restapi">[docs]</a><span class="k">def</span> <span class="nf">help_restapi</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render the help/restapi page.</span>

<span class="sd">        :param request: HTTP GET Request</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#handle login</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/help_restapi.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="help_jsonref"><a class="viewcode-back" href="../../Code.html#graphs.views.help_jsonref">[docs]</a><span class="k">def</span> <span class="nf">help_jsonref</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render the help/jsonref page.</span>

<span class="sd">        :param request: HTTP GET Request</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#handle login</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/help_jsonref.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="help_about"><a class="viewcode-back" href="../../Code.html#graphs.views.help_about">[docs]</a><span class="k">def</span> <span class="nf">help_about</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render the help/about page.</span>

<span class="sd">        :param request: HTTP GET Request</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#handle login</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/help_about.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="register"><a class="viewcode-back" href="../../Code.html#graphs.views.register">[docs]</a><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Register a new user.</span>

<span class="sd">        :param request: HTTP POST Request containing:</span>

<span class="sd">        {&quot;user_id&quot;: &lt;user_id&gt;, &quot;password&quot;: &lt;password&gt;}</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#if the form has been submitted</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span> <span class="ow">and</span> <span class="s">&#39;user_id&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span> <span class="ow">and</span> <span class="s">&#39;password&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
        <span class="c"># RegisterForm is bound to POST data</span>
        <span class="n">register_form</span> <span class="o">=</span> <span class="n">RegisterForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="c"># form validation</span>
        <span class="k">if</span> <span class="n">register_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c"># create new account by inserting the new account</span>
            <span class="c"># record to the database</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="n">register_form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;user_id&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">user_id</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Email already exists!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>
            
            <span class="c"># hash the password using bcrypt library</span>
            <span class="n">hashed_pw</span> <span class="o">=</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">hashpw</span><span class="p">(</span>
                            <span class="n">register_form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">],</span> 
                            <span class="n">bcrypt</span><span class="o">.</span><span class="n">gensalt</span><span class="p">())</span>
            <span class="n">activated</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">activate_code</span> <span class="o">=</span> <span class="s">&#39;activate_code&#39;</span>
            <span class="n">public</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">unlisted</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">admin</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c"># user table is on a separate database</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">]</span>

            <span class="c"># build insert statement to insert the new user</span>
            <span class="c"># info into the database.</span>
            <span class="n">new_user</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                                 <span class="n">password</span><span class="o">=</span><span class="n">hashed_pw</span><span class="p">,</span>
                                 <span class="n">activated</span><span class="o">=</span><span class="n">activated</span><span class="p">,</span>
                                 <span class="n">activate_code</span><span class="o">=</span><span class="n">activate_code</span><span class="p">,</span>
                                 <span class="n">public</span><span class="o">=</span><span class="n">public</span><span class="p">,</span>
                                 <span class="n">unlisted</span><span class="o">=</span><span class="n">unlisted</span><span class="p">,</span>
                                 <span class="n">admin</span><span class="o">=</span><span class="n">admin</span><span class="p">)</span>

            <span class="c"># make connection to the database</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
            <span class="c"># execute the insert statement</span>
            <span class="c"># see Executing part at</span>
            <span class="c"># http://docs.sqlalchemy.org/en/rel_0_9/core/tutorial.html#coretutorial-insert-expressions </span>
            <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">new_user</span><span class="p">)</span>
            <span class="c"># close connection</span>
            <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c"># should display success message. not there yet.</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/index/&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">register_form</span> <span class="o">=</span> <span class="n">RegisterForm</span><span class="p">()</span> <span class="c"># An unbound form</span>

    <span class="n">context</span><span class="p">[</span><span class="s">&#39;register_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">register_form</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;footer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/register.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="retrieveIDs"><a class="viewcode-back" href="../../Code.html#graphs.views.retrieveIDs">[docs]</a><span class="k">def</span> <span class="nf">retrieveIDs</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Retrieves ID&#39;s of the nodes.</span>
<span class="sd">        Used when highlighting elements of the graph.</span>

<span class="sd">        :param request: HTTP POST Request containing</span>

<span class="sd">        {uid: &lt;user_id&gt;, gid: &lt;graph_id&gt;, values: [labels/id&#39;s of edges/nodes return id for]}</span>

<span class="sd">        :return JSON: {&quot;IDS&quot;: [ids of nodes/edges in database]}</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#Grab id&#39;s of the nodes to highlight given the label of the nodes</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
        <span class="n">id_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">db_session</span> <span class="o">=</span> <span class="n">data_connection</span><span class="o">.</span><span class="n">new_session</span><span class="p">()</span>
        <span class="n">element_values</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">element_values</span><span class="p">:</span>
            <span class="n">element_id</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="c"># Find an edge</span>
            <span class="k">if</span> <span class="s">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">element</span><span class="p">:</span>
                <span class="n">element_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">find_edge</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;gid&#39;</span><span class="p">],</span> <span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">element_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;gid&#39;</span><span class="p">],</span> <span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">element_id</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">id_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;IDS&quot;</span><span class="p">:</span> <span class="n">id_values</span><span class="p">}))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseNotFound</span><span class="p">(</span><span class="s">&#39;&lt;h1&gt;Page not found&lt;/h1&gt;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="logout"><a class="viewcode-back" href="../../Code.html#graphs.views.logout">[docs]</a><span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Log the user out and display logout page.</span>

<span class="sd">        :param request: HTTP GET Request</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c"># TODO: should something be done here?</span>
        <span class="k">pass</span>

    <span class="c"># redirect to the main page after logout.</span>
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/index/&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="sendResetEmail"><a class="viewcode-back" href="../../Code.html#graphs.views.sendResetEmail">[docs]</a><span class="k">def</span> <span class="nf">sendResetEmail</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sends an email to the requester.</span>

<span class="sd">        :param request: HTTP POST Request containing:</span>

<span class="sd">        {&quot;forgot_email&quot;: &lt;user_id&gt;}</span>

<span class="sd">        :returns JSON: {&quot;Error|Success&quot;: &quot;Email does not exist! | &quot;Email has been sent!&quot;}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">emailId</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sendForgotEmail</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;forgot_email&#39;</span><span class="p">])</span>

    <span class="c"># If email is not found, throw an error</span>
    <span class="k">if</span> <span class="n">emailId</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Email does not exist!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Success&quot;</span><span class="p">:</span> <span class="s">&quot;Email has been sent!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>
</div>
<div class="viewcode-block" id="resetLink"><a class="viewcode-back" href="../../Code.html#graphs.views.resetLink">[docs]</a><span class="k">def</span> <span class="nf">resetLink</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Directs the user to a link that</span>
<span class="sd">        allows them to change their password.</span>

<span class="sd">        :param HTTP GET Request</span>
<span class="sd">        :return JSON: {&quot;email&quot;: &lt;user_id&gt; | &quot;Error&quot;: &quot;Unrecognized ID&quot;}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">retrieveResetInfo</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">email</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Unrecognized ID&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>

    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;email&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;graphs/reset.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="resetPassword"><a class="viewcode-back" href="../../Code.html#graphs.views.resetPassword">[docs]</a><span class="k">def</span> <span class="nf">resetPassword</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Resets the password of the user.</span>

<span class="sd">        :param request: HTTP POST Request containing</span>

<span class="sd">        {&quot;email&quot;: &lt;user_id&gt;, &quot;password&quot;: &quot;password&quot;}</span>

<span class="sd">        :return JSON: {&quot;Error|Success&quot;: &quot;Password Update not successful! | Password updated for &lt;user_id&gt;!&quot;}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">resetInfo</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">resetPassword</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;email&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">resetInfo</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Password Update not successful!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Success&quot;</span><span class="p">:</span> <span class="s">&quot;Password updated for &quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;email&#39;</span><span class="p">]}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>

</div>
<div class="viewcode-block" id="save_layout"><a class="viewcode-back" href="../../Code.html#graphs.views.save_layout">[docs]</a><span class="k">def</span> <span class="nf">save_layout</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Saves a layout for a graph.</span>

<span class="sd">        :param HTTP POST Request</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">save_layout</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;layout_id&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;layout_name&#39;</span><span class="p">],</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;loggedIn&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;public&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;unlisted&#39;</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="download"><a class="viewcode-back" href="../../Code.html#graphs.views.download">[docs]</a><span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Download the graph as an image.</span>

<span class="sd">        :param HTTP GET Request</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">]:</span>
            <span class="n">response</span> <span class="o">=</span>  <span class="n">HttpResponse</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">],</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;application/octet-stream&#39;</span><span class="p">)</span>
            <span class="n">response</span><span class="p">[</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;attachment; filename=&quot;foo.png&quot;&#39;</span>
            <span class="k">return</span> <span class="n">response</span>
</div>
<div class="viewcode-block" id="changeLayoutName"><a class="viewcode-back" href="../../Code.html#graphs.views.changeLayoutName">[docs]</a><span class="k">def</span> <span class="nf">changeLayoutName</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Changes the name of the layout</span>

<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>

<span class="sd">        {&quot;uid&quot;: &lt;username&gt;,&quot;gid&quot;: &lt;name of graph&gt;, &quot;old_layout_name&quot;: &lt;name of old layout&gt;, &quot;new_layout_name&quot;: &lt;new name of layout&gt;&quot;}</span>

<span class="sd">        :return JSON:  {&quot;Success&quot;: &lt;message&gt;}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">]</span>
    <span class="n">gid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;gid&#39;</span><span class="p">]</span>
    <span class="n">old_layout_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;old_layout_name&#39;</span><span class="p">]</span>
    <span class="n">new_layout_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;new_layout_name&#39;</span><span class="p">]</span>
    <span class="n">loggedIn</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;loggedIn&#39;</span><span class="p">]</span>

    <span class="n">db</span><span class="o">.</span><span class="n">changeLayoutName</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">old_layout_name</span><span class="p">,</span> <span class="n">new_layout_name</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Success&quot;</span><span class="p">:</span> <span class="s">&quot;Layout name changed!&quot;</span><span class="p">,</span> <span class="s">&quot;url&quot;</span><span class="p">:</span> <span class="s">&quot;http://localhost:8000/graphs/&quot;</span> <span class="o">+</span> <span class="n">uid</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">gid</span> <span class="o">+</span> <span class="s">&#39;/?layout=&#39;</span> <span class="o">+</span> <span class="n">new_layout_name</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="deleteLayout"><a class="viewcode-back" href="../../Code.html#graphs.views.deleteLayout">[docs]</a><span class="k">def</span> <span class="nf">deleteLayout</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Deletes layout of a graph</span>

<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>

<span class="sd">        {&quot;owner&quot;: &lt;owner of graph&gt;,&quot;gid&quot;: &lt;name of graph&gt;, &quot;layout&quot;: &lt;name of layout to delete&gt;, &quot;user_id&quot;: &lt;layout that user belongs to&gt;&quot;}</span>

<span class="sd">        :return JSON:  {&quot;Success&quot;: &lt;message&gt;}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;owner&#39;</span><span class="p">]</span>
    <span class="n">gid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;gid&#39;</span><span class="p">]</span>
    <span class="n">layoutToDelete</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;layout&#39;</span><span class="p">]</span>
    <span class="n">loggedIn</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;user_id&#39;</span><span class="p">]</span>

    <span class="n">db</span><span class="o">.</span><span class="n">deleteLayout</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">layoutToDelete</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Success&quot;</span><span class="p">:</span> <span class="s">&quot;Layout deleted!&quot;</span><span class="p">,</span> <span class="s">&quot;url&quot;</span><span class="p">:</span> <span class="s">&quot;http://localhost:8000/graphs/&quot;</span> <span class="o">+</span> <span class="n">uid</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">gid</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="makeLayoutPublic"><a class="viewcode-back" href="../../Code.html#graphs.views.makeLayoutPublic">[docs]</a><span class="k">def</span> <span class="nf">makeLayoutPublic</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Makes a layout of graph public</span>

<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>

<span class="sd">        {&quot;owner&quot;: &lt;owner of graph&gt;,&quot;gid&quot;: &lt;name of graph&gt;, &quot;layout&quot;: &lt;name of layout to delete&gt;, &quot;user_id&quot;: &lt;layout that user belongs to&gt;&quot;}</span>

<span class="sd">        :return JSON:  {&quot;Success&quot;: &lt;message&gt;}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;owner&#39;</span><span class="p">]</span>
    <span class="n">gid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;gid&#39;</span><span class="p">]</span>
    <span class="n">layoutToMakePpublic</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;layout&#39;</span><span class="p">]</span>
    <span class="n">loggedIn</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;user_id&#39;</span><span class="p">]</span>

    <span class="n">db</span><span class="o">.</span><span class="n">makeLayoutPublic</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">layoutToMakePpublic</span><span class="p">,</span> <span class="n">loggedIn</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Success&quot;</span><span class="p">:</span> <span class="s">&quot;Layout made public!&quot;</span><span class="p">,</span> <span class="s">&quot;url&quot;</span><span class="p">:</span> <span class="s">&quot;http://localhost:8000/graphs/&quot;</span> <span class="o">+</span> <span class="n">uid</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">gid</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="create_group"><a class="viewcode-back" href="../../Code.html#graphs.views.create_group">[docs]</a><span class="k">def</span> <span class="nf">create_group</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">groupname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Allows group creation from the GUI.</span>

<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>

<span class="sd">        {&quot;owner&quot;: &lt;owner of group&gt;, &quot;groupname&quot;: &lt; name of group&gt;}</span>

<span class="sd">        :return JSON: {&quot;Upload&quot;: &lt;message&gt;, &quot;Group Name | Error&quot;: &lt;message&gt; }</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c"># If request is a POST request, add it to the server</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">group_created</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">groupname</span><span class="p">)</span>
        
        <span class="c"># If there isn&#39;t already a group name that exists with the same name under account</span>
        <span class="c"># add it to account</span>
        <span class="k">if</span> <span class="n">group_created</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Upload&quot;</span><span class="p">:</span> <span class="s">&quot;Success&quot;</span><span class="p">,</span> <span class="s">&quot;Group Name&quot;</span><span class="p">:</span> <span class="n">group_created</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Upload&quot;</span><span class="p">:</span> <span class="s">&quot;Fail&quot;</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Group name already exists for this account&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

<span class="c">##### END VIEWS #####</span>

<span class="c">##### REST API #####</span>
</div>
<div class="viewcode-block" id="upload_graph"><a class="viewcode-back" href="../../Code.html#graphs.views.upload_graph">[docs]</a><span class="k">def</span> <span class="nf">upload_graph</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">graphname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Uploads a graph for a user</span>

<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>

<span class="sd">        {&quot;username&quot;: &lt;username&gt;,&quot;password&quot;: &lt;password&gt;}</span>

<span class="sd">        :param user_id: Id of the user</span>
<span class="sd">        :param graphname: Name of the graph</span>
<span class="sd">        </span>
<span class="sd">        :return response: JSON Response: {&quot;Success|Error&quot;: &lt;message&gt;}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Usernames do not match!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="n">graph_errors</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">insert_graph</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">graphname</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s">&#39;graphname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">graph_errors</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="n">graph_errors</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Success&quot;</span><span class="p">:</span> <span class="s">&quot;Graph inserted into GraphSpace!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="retrieve_graph"><a class="viewcode-back" href="../../Code.html#graphs.views.retrieve_graph">[docs]</a><span class="k">def</span> <span class="nf">retrieve_graph</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">graphname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Retrieves the json of a specified graph</span>

<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>

<span class="sd">        {&quot;username&quot;: &lt;username&gt;,&quot;password&quot;: &lt;password&gt;}</span>

<span class="sd">        :param user_id: Id of the user</span>
<span class="sd">        :param graphname: Name of the graph</span>
<span class="sd">        </span>
<span class="sd">        :return response: JSON Response: {&quot;Graph|Error&quot;: &lt;message&gt;}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Usernames do not match!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="n">jsonData</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_graph_json</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">graphname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">jsonData</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Graph&quot;</span><span class="p">:</span> <span class="n">jsonData</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;No Such Graph Exists&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="remove_graph"><a class="viewcode-back" href="../../Code.html#graphs.views.remove_graph">[docs]</a><span class="k">def</span> <span class="nf">remove_graph</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">graphname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Removes a graph from the server</span>

<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>

<span class="sd">        {&quot;username&quot;: &lt;username&gt;,&quot;password&quot;: &lt;password&gt;}</span>

<span class="sd">        :param user_id: Id of the user</span>
<span class="sd">        :param graphname: Name of the graph</span>
<span class="sd">        </span>
<span class="sd">        :return response: JSON Response: {&quot;Success|Error&quot;: &lt;message&gt;}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Usernames do not match!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
  
        <span class="n">jsonData</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_graph_json</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">graphname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">jsonData</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">delete_graph</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">graphname</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Success&quot;</span><span class="p">:</span> <span class="s">&quot;Successfully deleted &quot;</span> <span class="o">+</span> <span class="n">graphname</span> <span class="o">+</span> <span class="s">&quot; owned by &quot;</span> <span class="o">+</span> <span class="n">user_id</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;No Such Graph Exists&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="view_all_graphs_for_user"><a class="viewcode-back" href="../../Code.html#graphs.views.view_all_graphs_for_user">[docs]</a><span class="k">def</span> <span class="nf">view_all_graphs_for_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        View all graphs for a user</span>

<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>

<span class="sd">        {&quot;username&quot;: &lt;username&gt;,&quot;password&quot;: &lt;password&gt;}</span>

<span class="sd">        :return response: JSON Response: {&quot;Graphs|Error&quot;: &lt;message&gt;}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Usernames do not match!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_graphs_for_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Graphs&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>

</div>
<div class="viewcode-block" id="get_groups"><a class="viewcode-back" href="../../Code.html#graphs.views.get_groups">[docs]</a><span class="k">def</span> <span class="nf">get_groups</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all groups that are on this server</span>

<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>

<span class="sd">        {&quot;username&quot;: &lt;username&gt;,&quot;password&quot;: &lt;password&gt;}</span>

<span class="sd">        :return response: JSON Response: {&quot;Groups|Error&quot;: &lt;message&gt;}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_groups_in_server</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Groups&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>
</div>
<div class="viewcode-block" id="get_group"><a class="viewcode-back" href="../../Code.html#graphs.views.get_group">[docs]</a><span class="k">def</span> <span class="nf">get_group</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">groupname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all members of this group </span>

<span class="sd">        :param request: Incoming HTTP POST Request containing: {&quot;username&quot;: &lt;username&gt;,&quot;password&quot;: &lt;password&gt;}</span>
<span class="sd">        :param groupname: Name of group to get from server</span>
<span class="sd">        :return response: JSON Response: {&quot;Groups|Error&quot;: &lt;message&gt;}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">groupname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Groups&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>

</div>
<div class="viewcode-block" id="delete_group"><a class="viewcode-back" href="../../Code.html#graphs.views.delete_group">[docs]</a><span class="k">def</span> <span class="nf">delete_group</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">groupname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Deletes a group from the server.</span>
<span class="sd">        </span>
<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>

<span class="sd">        {&quot;username&quot;: &lt;username&gt;,&quot;password&quot;: &lt;password&gt;}</span>
<span class="sd">        :param groupname: Name of group to delete from server</span>

<span class="sd">        :return response: JSON Response: {&quot;Success|Failure&quot;: &lt;message&gt;}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">remove_group</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">groupname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Success&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>

</div>
<div class="viewcode-block" id="add_group"><a class="viewcode-back" href="../../Code.html#graphs.views.add_group">[docs]</a><span class="k">def</span> <span class="nf">add_group</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">groupname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a group to the server.  If groupname already exists under a user account, then it will fail, otherwise a group name is created under the user&#39;s account.</span>

<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>
<span class="sd">        </span>
<span class="sd">        {&quot;username&quot;: &lt;username&gt;,&quot;password&quot;: &lt;password&gt;}</span>

<span class="sd">        :param group: Name of group to add to server</span>
<span class="sd">        :return response: JSON Response: {Upload: &quot;Success|Failure&quot;, &quot;Group Name|Error&quot;: group | error}</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c"># If request is a POST request, add it to the server</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">create_group</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">groupname</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="get_group_for_user"><a class="viewcode-back" href="../../Code.html#graphs.views.get_group_for_user">[docs]</a><span class="k">def</span> <span class="nf">get_group_for_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Gets all groups that a user is a part of.  </span>

<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>

<span class="sd">        {&quot;username&quot;: &lt;username&gt;,&quot;password&quot;: &lt;password&gt;}</span>

<span class="sd">        :param user_id: Email of the user to get the groups for</span>
<span class="sd">        :return JSON Response: {&quot;User&quot;: &lt;user_id&gt;, &quot;Groups&quot;: &lt;name of groups for the user&gt;}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="n">group</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">groups_for_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;User&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="s">&quot;Groups&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="add_user_to_group"><a class="viewcode-back" href="../../Code.html#graphs.views.add_user_to_group">[docs]</a><span class="k">def</span> <span class="nf">add_user_to_group</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">groupname</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds specified user to a group.</span>

<span class="sd">        :param request: Incoming HTTP POST Request containing:</span>

<span class="sd">        {&quot;username&quot;: &lt;username&gt;,&quot;password&quot;: &lt;password&gt;}    </span>

<span class="sd">        :param groupname: Name of group to add user to</span>
<span class="sd">        :param user_id: Email of user to add to the group</span>
<span class="sd">        :return JSON Response: {&quot;Response&quot;: &lt;response&gt;}</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="c"># Check to see if the user/password is acceptable</span>
        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="c"># Adds user to group</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">add_user_to_group</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">groupname</span><span class="p">)</span>

        <span class="c"># If nothing is returned, that means that something went wrong</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>  <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Group doesn&#39;t exist or user has already been added!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Response&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="remove_user_from_group"><a class="viewcode-back" href="../../Code.html#graphs.views.remove_user_from_group">[docs]</a><span class="k">def</span> <span class="nf">remove_user_from_group</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">groupname</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Removes user from group</span>

<span class="sd">        :param HTTP POST Request containing</span>
<span class="sd">        {&quot;username&quot;: &lt;user_id&gt;, &quot;password&quot;: &lt;password&gt;}    </span>
<span class="sd">        :param groupname: Name of group to remove user from</span>
<span class="sd">        :param user_id: Email of user to remove</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="n">group</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">remove_user_from_group</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">groupname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Response&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="share_graph"><a class="viewcode-back" href="../../Code.html#graphs.views.share_graph">[docs]</a><span class="k">def</span> <span class="nf">share_graph</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">graphname</span><span class="p">,</span> <span class="n">groupname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Share a graph with group.</span>

<span class="sd">        :param HTTP POST Request containing</span>
<span class="sd">        {&quot;username&quot;: &lt;user_id&gt;, &quot;password&quot;: &lt;password&gt;}</span>
<span class="sd">        :param graphname: Name of graph to unshare_graph</span>
<span class="sd">        :param groupname: Name of group to unshare graph with</span>

<span class="sd">        :return JSON: {&quot;Response&quot;: &lt;message&gt;}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">share_graph_with_group</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">graphname</span><span class="p">,</span> <span class="n">groupname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Response&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="unshare_graph"><a class="viewcode-back" href="../../Code.html#graphs.views.unshare_graph">[docs]</a><span class="k">def</span> <span class="nf">unshare_graph</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">graphname</span><span class="p">,</span> <span class="n">groupname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Unshare a graph from a group.</span>

<span class="sd">        :param HTTP POST Request containing</span>
<span class="sd">        {&quot;username&quot;: &lt;user_id&gt;, &quot;password&quot;: &lt;password&gt;}</span>
<span class="sd">        :param graphname: Name of graph to unshare_graph</span>
<span class="sd">        :param groupname: Name of group to unshare graph with</span>

<span class="sd">        :return JSON: {&quot;Response&quot;: &lt;message&gt;}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">unshare_graph_with_group</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">graphname</span><span class="p">,</span> <span class="n">groupname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Response&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="get_tags_for_user"><a class="viewcode-back" href="../../Code.html#graphs.views.get_tags_for_user">[docs]</a><span class="k">def</span> <span class="nf">get_tags_for_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all tags that a user has under their name</span>
<span class="sd">        :param HTTP POST Request containing</span>
<span class="sd">        {&quot;username&quot;: &lt;user_id&gt;, &quot;password&quot;: &lt;password&gt;}</span>
<span class="sd">        :param username: Name of user to get tags from</span>

<span class="sd">        :return JSON: {&quot;Response&quot;: &lt;message&gt;}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_tags_for_user</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Response&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="get_all_tags_for_graph"><a class="viewcode-back" href="../../Code.html#graphs.views.get_all_tags_for_graph">[docs]</a><span class="k">def</span> <span class="nf">get_all_tags_for_graph</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">graphname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all tags that a user has under their graph</span>
<span class="sd">        :param HTTP POST Request containing</span>
<span class="sd">        {&quot;username&quot;: &lt;user_id&gt;, &quot;password&quot;: &lt;password&gt;}</span>
<span class="sd">        :param graphname: Name of graph to get tags from</span>
<span class="sd">        :param username: Name of user to get graph of</span>

<span class="sd">        :return JSON: {&quot;Response&quot;: &lt;message&gt;}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>


        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_tags_for_graph</span><span class="p">(</span><span class="n">graphname</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Response&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="get_all_graphs_for_tags"><a class="viewcode-back" href="../../Code.html#graphs.views.get_all_graphs_for_tags">[docs]</a><span class="k">def</span> <span class="nf">get_all_graphs_for_tags</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all graphs associated with these tags</span>
<span class="sd">        :param HTTP POST Request containing</span>
<span class="sd">        {&quot;username&quot;: &lt;user_id&gt;, &quot;password&quot;: &lt;password&gt;}</span>
<span class="sd">        :param tag: Name of tag to get graphs of </span>

<span class="sd">        :return JSON: {&quot;Response&quot;: &lt;message&gt;}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_valid_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Error&quot;</span><span class="p">:</span> <span class="s">&quot;Username/Password is not recognized!&quot;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_graphs_for_tags</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;Response&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">GraphSpace Documentation 0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Divit Singh.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>